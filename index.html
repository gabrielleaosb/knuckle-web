<!doctype html>
<html lang="pt-BR" id="html-root">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Knucklebones</title>
    <link rel="icon" type="image/png" sizes="32x32" href="src/images/KB.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap"
      rel="stylesheet"
    />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      :root {
        --gold: #c9a84c;
        --gold-light: #e8c97a;
        --deep: #0a0806;
        --card: #13100a;
        --cream: #e8dfc8;
        --purple: #8b2fc9;
        --green: #4ade80;
        --red: #f87171;
      }
      html {
        font-size: 16px;
      }
      body {
        font-family: "Crimson Text", serif;
        background-color: var(--deep);
        color: var(--cream);
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background:
          repeating-linear-gradient(
            45deg,
            transparent,
            transparent 2px,
            rgba(0, 0, 0, 0.03) 2px,
            rgba(0, 0, 0, 0.03) 4px
          ),
          radial-gradient(
            ellipse at 50% 50%,
            #0d1a0f 0%,
            #06100a 60%,
            #020804 100%
          );
        pointer-events: none;
        z-index: 0;
      }

      /* ‚îÄ‚îÄ LANGUAGE SWITCHER ‚îÄ‚îÄ */
      #lang-switcher {
        position: fixed;
        top: 14px;
        right: 16px;
        z-index: 800;
        display: flex;
        align-items: center;
        gap: 0;
        border: 1px solid rgba(201, 168, 76, 0.35);
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(6px);
        box-shadow: 0 0 14px rgba(201, 168, 76, 0.08);
        overflow: hidden;
      }
      .lang-btn {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.58rem;
        letter-spacing: 0.12em;
        padding: 7px 11px;
        background: transparent;
        border: none;
        color: rgba(201, 168, 76, 0.45);
        cursor: pointer;
        transition:
          background 0.2s,
          color 0.2s;
        white-space: nowrap;
      }
      .lang-btn:hover {
        color: rgba(201, 168, 76, 0.8);
        background: rgba(201, 168, 76, 0.06);
      }
      .lang-btn.active {
        background: linear-gradient(
          135deg,
          rgba(201, 168, 76, 0.18),
          rgba(201, 168, 76, 0.08)
        );
        color: #fef08a;
        box-shadow: inset 0 0 8px rgba(201, 168, 76, 0.12);
      }
      .lang-divider {
        width: 1px;
        height: 22px;
        background: rgba(201, 168, 76, 0.25);
        flex-shrink: 0;
      }

      /* ‚îÄ‚îÄ KO-FI BUTTON ‚îÄ‚îÄ */
      #kofi-btn {
        position: fixed;
        bottom: 16px;
        right: 16px;
        z-index: 800;
        display: flex;
        align-items: center;
        gap: 7px;
        padding: 8px 14px;
        background: rgba(0, 0, 0, 0.55);
        border: 1px solid rgba(255, 94, 91, 0.35);
        backdrop-filter: blur(6px);
        color: rgba(255, 150, 148, 0.8);
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.58rem;
        letter-spacing: 0.1em;
        cursor: pointer;
        text-decoration: none;
        transition:
          border-color 0.2s,
          box-shadow 0.2s,
          color 0.2s,
          transform 0.2s;
        box-shadow: 0 0 10px rgba(255, 94, 91, 0.06);
      }
      #kofi-btn:hover {
        border-color: rgba(255, 94, 91, 0.65);
        color: #ffb3b1;
        box-shadow: 0 0 18px rgba(255, 94, 91, 0.18);
        transform: translateY(-1px);
      }
      .kofi-icon {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
        fill: currentColor;
      }

      /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
      .screen {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        min-height: 100dvh;
        padding: 20px 16px;
        gap: 20px;
        position: relative;
        z-index: 1;
        animation: fadeIn 0.4s ease;
      }
      .screen.active {
        display: flex;
      }
      #screen-game,
      #screen-king-game {
        justify-content: flex-start;
        padding: 12px 16px;
        gap: 10px;
      }
      #screen-king-lobby {
        justify-content: flex-start;
        padding: 16px 12px;
        gap: 10px;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ */
      .cinzel {
        font-family: "Cinzel Decorative", cursive;
      }
      .title-sub {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.6rem, 2vw, 0.75rem);
        letter-spacing: 0.3em;
        color: rgba(201, 168, 76, 0.75);
        text-align: center;
        margin-bottom: 24px;
      }
      .title-main {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(2.2rem, 8vw, 4rem);
        font-weight: 900;
        color: var(--gold);
        line-height: 1.05;
        text-align: center;
        text-shadow: 0 0 40px rgba(201, 168, 76, 0.5);
      }
      .ornament {
        display: flex;
        align-items: center;
        gap: 12px;
        color: rgba(201, 168, 76, 0.4);
        font-size: 1rem;
        width: 100%;
      }
      .ornament::before,
      .ornament::after {
        content: "";
        flex: 1;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(201, 168, 76, 0.4),
          transparent
        );
      }
      .hint-text {
        font-size: clamp(0.75rem, 2vw, 0.85rem);
        color: rgba(201, 168, 76, 0.35);
        text-align: center;
        max-width: 360px;
      }

      /* ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ */
      .panel {
        border: 1px solid var(--gold);
        box-shadow:
          0 0 12px rgba(201, 168, 76, 0.15),
          inset 0 0 12px rgba(0, 0, 0, 0.4);
        background: rgba(0, 0, 0, 0.4);
        padding: clamp(16px, 4vw, 28px);
        width: 100%;
        max-width: 420px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .panel-center {
        text-align: center;
        gap: 20px;
      }

      /* ‚îÄ‚îÄ LOBBY NAME ‚îÄ‚îÄ */
      .lobby-name-section {
        width: 100%;
        max-width: 320px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      /* ‚îÄ‚îÄ LOBBY MODES GRID ‚îÄ‚îÄ */
      .lobby-modes {
        width: 100%;
        max-width: 760px;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
      }
      .mode-card {
        border: 1px solid rgba(201, 168, 76, 0.3);
        background: rgba(0, 0, 0, 0.35);
        padding: clamp(14px, 3vw, 22px) clamp(10px, 2vw, 14px);
        display: flex;
        flex-direction: column;
        gap: 12px;
        transition:
          border-color 0.2s,
          box-shadow 0.2s;
      }
      .mode-card:hover {
        border-color: rgba(201, 168, 76, 0.55);
        box-shadow: 0 0 16px rgba(201, 168, 76, 0.08);
      }
      .mode-card.king {
        border-color: rgba(139, 47, 201, 0.35);
      }
      .mode-card.king:hover {
        border-color: rgba(139, 47, 201, 0.65);
        box-shadow: 0 0 16px rgba(139, 47, 201, 0.1);
      }
      .mode-card.join {
        border-color: rgba(201, 168, 76, 0.2);
      }
      .mode-card.join:hover {
        border-color: rgba(201, 168, 76, 0.45);
        box-shadow: 0 0 16px rgba(201, 168, 76, 0.06);
      }
      .mode-card.bot {
        border-color: rgba(74, 222, 128, 0.25);
      }
      .mode-card.bot:hover {
        border-color: rgba(74, 222, 128, 0.55);
        box-shadow: 0 0 16px rgba(74, 222, 128, 0.08);
      }
      .mode-card.bot .mode-card-title {
        color: rgba(134, 239, 172, 0.9);
      }
      .mode-card.tutorial-card {
        border-color: rgba(56, 189, 248, 0.3);
        cursor: pointer;
      }
      .mode-card.tutorial-card:hover {
        border-color: rgba(56, 189, 248, 0.65);
        box-shadow: 0 0 16px rgba(56, 189, 248, 0.1);
      }
      .mode-card.tutorial-card .mode-card-title {
        color: rgba(125, 211, 252, 0.9);
      }
      .bot-difficulty-select {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(74, 222, 128, 0.3);
        color: var(--cream);
        padding: 8px 10px;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.55rem, 1.5vw, 0.62rem);
        letter-spacing: 0.08em;
        outline: none;
        width: 100%;
        cursor: pointer;
        transition: border-color 0.2s;
      }
      .bot-difficulty-select:focus {
        border-color: rgba(74, 222, 128, 0.6);
      }
      .mode-card.coming-soon {
        border-color: rgba(201, 168, 76, 0.1);
        opacity: 0.55;
        position: relative;
        pointer-events: none;
      }
      .coming-soon-badge {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.55rem;
        letter-spacing: 0.18em;
        color: #0a0806;
        background: linear-gradient(135deg, #c9a84c, #a07830);
        padding: 4px 10px;
        text-align: center;
        width: fit-content;
        margin: 0 auto;
        white-space: nowrap;
      }
      .mode-card-icon {
        font-size: clamp(1.5rem, 4vw, 2rem);
        text-align: center;
        line-height: 1;
      }
      .mode-card-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.62rem, 1.8vw, 0.78rem);
        letter-spacing: 0.1em;
        color: rgba(201, 168, 76, 1);
        text-align: center;
      }
      .mode-card.king .mode-card-title {
        color: rgba(192, 132, 252, 0.85);
      }
      .mode-card.join .mode-card-title {
        color: rgba(201, 168, 76, 0.7);
      }
      .mode-card.coming-soon .mode-card-title {
        color: rgba(201, 168, 76, 0.5);
      }
      .mode-card-desc {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.52rem, 1.5vw, 0.62rem);
        letter-spacing: 0.06em;
        color: rgba(201, 168, 76, 0.5);
        text-align: center;
        line-height: 1.6;
      }

      /* ‚îÄ‚îÄ INPUTS / BUTTONS ‚îÄ‚îÄ */
      .field {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .field-label {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.18em;
        color: rgba(201, 168, 76, 0.75);
      }
      .game-input {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(201, 168, 76, 0.4);
        color: var(--cream);
        padding: 10px 12px;
        font-family: "Crimson Text", serif;
        font-size: clamp(0.9rem, 2.5vw, 1rem);
        outline: none;
        transition:
          border-color 0.2s,
          box-shadow 0.2s;
        width: 100%;
      }
      .game-input:focus {
        border-color: var(--gold);
        box-shadow: 0 0 10px rgba(201, 168, 76, 0.2);
      }
      .game-input::placeholder {
        color: rgba(232, 223, 200, 0.3);
      }
      .game-input.code-style {
        text-transform: uppercase;
        letter-spacing: 0.2em;
        text-align: center;
        font-size: clamp(0.85rem, 2.5vw, 1rem);
      }
      .btn-gold {
        background: linear-gradient(135deg, #c9a84c, #a07830);
        color: #0a0806;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        font-weight: 700;
        padding: 11px 16px;
        border: none;
        cursor: pointer;
        letter-spacing: 0.08em;
        transition:
          box-shadow 0.2s,
          transform 0.2s;
        position: relative;
        overflow: hidden;
        width: 100%;
      }
      .btn-gold::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.4s;
      }
      .btn-gold:hover::before {
        left: 100%;
      }
      .btn-gold:hover {
        box-shadow: 0 0 20px rgba(201, 168, 76, 0.5);
        transform: translateY(-1px);
      }
      .btn-gold:active {
        transform: translateY(0);
      }
      .btn-gold:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
      }
      .btn-outline {
        background: transparent;
        color: var(--gold);
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        font-weight: 700;
        padding: 10px 16px;
        border: 1px solid var(--gold);
        cursor: pointer;
        letter-spacing: 0.06em;
        transition:
          background 0.2s,
          box-shadow 0.2s;
        width: 100%;
      }
      .btn-outline:hover {
        background: rgba(201, 168, 76, 0.1);
        box-shadow: 0 0 12px rgba(201, 168, 76, 0.3);
      }
      .btn-outline.sm {
        font-size: clamp(0.6rem, 1.6vw, 0.68rem);
        padding: 8px 14px;
        opacity: 0.8;
      }
      .btn-outline:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }
      .btn-king {
        background: linear-gradient(135deg, #8b2fc9, #5a1a8a);
        color: #f5e6ff;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        font-weight: 700;
        padding: 11px 16px;
        border: none;
        cursor: pointer;
        letter-spacing: 0.08em;
        transition:
          box-shadow 0.2s,
          transform 0.2s;
        position: relative;
        overflow: hidden;
        width: 100%;
      }
      .btn-king::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.18),
          transparent
        );
        transition: left 0.4s;
      }
      .btn-king:hover::before {
        left: 100%;
      }
      .btn-king:hover {
        box-shadow: 0 0 20px rgba(139, 47, 201, 0.55);
        transform: translateY(-1px);
      }
      .btn-king:active {
        transform: translateY(0);
      }
      .btn-king.queue-btn,
      .btn-outline.queue-btn {
        width: auto;
        font-size: clamp(0.6rem, 1.6vw, 0.68rem);
        padding: 8px 20px;
      }
      .btn-sky {
        background: linear-gradient(135deg, #0ea5e9, #0369a1);
        color: #f0f9ff;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        font-weight: 700;
        padding: 11px 16px;
        border: none;
        cursor: pointer;
        letter-spacing: 0.08em;
        transition:
          box-shadow 0.2s,
          transform 0.2s;
        width: 100%;
      }
      .btn-sky:hover {
        box-shadow: 0 0 20px rgba(14, 165, 233, 0.5);
        transform: translateY(-1px);
      }
      .btn-bot {
        background: linear-gradient(135deg, #16a34a, #15803d);
        color: #f0fdf4;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        font-weight: 700;
        padding: 11px 16px;
        border: none;
        cursor: pointer;
        letter-spacing: 0.08em;
        transition:
          box-shadow 0.2s,
          transform 0.2s;
        width: 100%;
      }
      .btn-bot:hover {
        box-shadow: 0 0 20px rgba(74, 222, 128, 0.45);
        transform: translateY(-1px);
      }

      /* ‚îÄ‚îÄ WAITING ‚îÄ‚îÄ */
      .room-code-display {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(2.5rem, 8vw, 3.5rem);
        font-weight: 900;
        color: #fef08a;
        letter-spacing: 0.15em;
        text-shadow: 0 0 20px rgba(201, 168, 76, 0.6);
      }
      .waiting-label {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.2em;
        color: rgba(201, 168, 76, 0.75);
      }
      .waiting-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(1.3rem, 4vw, 1.8rem);
        color: var(--gold);
      }
      .status-msg {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.12em;
        text-align: center;
        min-height: 1.5em;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }
      .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        flex-shrink: 0;
      }
      .dot-green {
        background: #4ade80;
        box-shadow: 0 0 6px #4ade80;
      }
      .dot-yellow {
        background: #fbbf24;
        box-shadow: 0 0 6px #fbbf24;
        animation: blink 1s infinite;
      }
      .dot-grey {
        background: #4b5563;
        box-shadow: none;
      }
      .bot-indicator {
        font-size: 0.85rem;
        line-height: 1;
        flex-shrink: 0;
      }
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      /* ‚îÄ‚îÄ GAME BOARD ‚îÄ‚îÄ */
      .game-header {
        width: 100%;
        max-width: 520px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 4px;
      }
      .game-header-label {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.15em;
        color: rgba(201, 168, 76, 0.75);
      }
      .board-section {
        width: 100%;
        max-width: 520px;
      }
      .player-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
      }
      .player-row.bottom {
        margin-bottom: 0;
        margin-top: 8px;
      }
      .player-name-wrap {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .player-name {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.72rem, 2vw, 0.85rem);
        color: var(--gold);
      }
      .score-display {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(1.4rem, 4vw, 1.8rem);
        color: var(--gold);
      }
      .board-wrap {
        border: 1px solid var(--gold);
        box-shadow:
          0 0 12px rgba(201, 168, 76, 0.15),
          inset 0 0 12px rgba(0, 0, 0, 0.4);
        background: rgba(0, 0, 0, 0.3);
        padding: clamp(10px, 3vw, 16px);
        border-radius: 4px;
      }
      .board-grid {
        display: flex;
        justify-content: center;
        gap: clamp(6px, 2vw, 12px);
      }
      .turn-area {
        display: flex;
        flex-direction: column;
        min-height: 110px;
        align-items: center;
        gap: 6px;
        padding: 4px 0;
      }
      .turn-status {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.12em;
        text-align: center;
        min-height: 1.4em;
        color: var(--gold-light);
      }
      .sub-status {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.1em;
        text-align: center;
        min-height: 1.2em;
        color: rgba(201, 168, 76, 0.5);
      }
      .rules-hint {
        width: 100%;
        max-width: 520px;
        text-align: center;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.48rem, 1.4vw, 0.6rem);
        letter-spacing: 0.05em;
        color: rgba(201, 168, 76, 0.25);
        margin-top: 2px;
      }
      .board-col {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: clamp(4px, 1.5vw, 6px);
      }
      .board-col.selectable {
        cursor: pointer;
      }
      .board-col.selectable:hover .die.empty {
        border-color: rgba(201, 168, 76, 0.5);
        background: rgba(201, 168, 76, 0.05);
      }
      .col-score {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.6rem, 1.8vw, 0.75rem);
        color: var(--gold-light);
        text-align: center;
        min-width: var(--die-size, 52px);
        min-height: 18px;
      }

      /* ‚îÄ‚îÄ DICE ‚îÄ‚îÄ */
      :root {
        --die-size: 52px;
        --die-font: 1.3rem;
      }
      @media (max-width: 480px) {
        :root {
          --die-size: 42px;
          --die-font: 1rem;
        }
      }
      @media (max-width: 380px) {
        :root {
          --die-size: 36px;
          --die-font: 0.9rem;
        }
      }
      .die {
        width: var(--die-size);
        height: var(--die-size);
        background: linear-gradient(135deg, #f5f0e8 0%, #d4cbb8 100%);
        border-radius: 10px;
        border: 2px solid rgba(0, 0, 0, 0.3);
        box-shadow:
          3px 3px 8px rgba(0, 0, 0, 0.6),
          inset -2px -2px 4px rgba(0, 0, 0, 0.2),
          inset 2px 2px 4px rgba(255, 255, 255, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--die-font);
        font-weight: 900;
        color: #1a1a1a;
        transition: all 0.2s;
        cursor: default;
        font-family: "Cinzel Decorative", cursive;
        position: relative;
      }
      .die.empty {
        background: rgba(0, 0, 0, 0.3);
        border: 2px dashed rgba(201, 168, 76, 0.2);
        box-shadow: none;
      }
      .die.val-high {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
      }
      .die.val-mid {
        background: linear-gradient(135deg, #f5f0e8, #d4cbb8);
      }
      .die.val-low {
        background: linear-gradient(135deg, #e8e0d0, #c8bfaa);
      }
      .die.cancelling {
        animation: dieCancel 0.45s ease forwards;
      }
      @keyframes dieCancel {
        0% {
          transform: scale(1);
          opacity: 1;
          background: #f87171;
          box-shadow: 0 0 16px rgba(248, 113, 113, 0.8);
        }
        40% {
          transform: scale(1.25);
          opacity: 0.9;
        }
        100% {
          transform: scale(0);
          opacity: 0;
        }
      }
      .rolling-die {
        width: var(--die-size);
        height: var(--die-size);
        background: linear-gradient(135deg, #f5f0e8, #d4cbb8);
        border-radius: 10px;
        border: 3px solid var(--gold);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: calc(var(--die-font) * 1.1);
        font-weight: 900;
        color: #1a1a1a;
        font-family: "Cinzel Decorative", cursive;
        box-shadow: 0 0 25px rgba(201, 168, 76, 0.6);
      }
      .rolling-die.is-rolling {
        animation: rollShake 0.55s ease-in-out infinite;
      }
      .rolling-die.is-settled {
        animation: floatdie 2s ease-in-out infinite;
        border-color: var(--gold);
        box-shadow: 0 0 25px rgba(201, 168, 76, 0.7);
      }
      .rolling-die.is-opponent {
        animation: floatdie 2s ease-in-out infinite;
        border-color: #666;
        box-shadow: 0 0 12px rgba(100, 100, 100, 0.4);
        filter: grayscale(0.5);
      }
      @keyframes rollShake {
        0% {
          transform: translateY(0) rotate(-8deg) scale(1);
        }
        20% {
          transform: translateY(-6px) rotate(6deg) scale(1.06);
        }
        40% {
          transform: translateY(2px) rotate(-5deg) scale(0.97);
        }
        60% {
          transform: translateY(-4px) rotate(7deg) scale(1.04);
        }
        80% {
          transform: translateY(1px) rotate(-4deg) scale(0.99);
        }
        100% {
          transform: translateY(0) rotate(-8deg) scale(1);
        }
      }
      @keyframes floatdie {
        0%,
        100% {
          transform: translateY(0) rotate(-5deg);
        }
        50% {
          transform: translateY(-8px) rotate(5deg);
        }
      }

      /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
      #toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-120px);
        background: var(--card);
        border: 1px solid var(--gold);
        padding: 12px 24px;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.1em;
        color: var(--gold-light);
        z-index: 1000;
        transition: transform 0.3s ease;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
        white-space: nowrap;
        max-width: 90vw;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      #toast.show {
        transform: translateX(-50%) translateY(0);
      }

      /* ‚îÄ‚îÄ WINNER OVERLAY ‚îÄ‚îÄ */
      #winner-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.88);
        z-index: 500;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 20px;
        text-align: center;
        padding: 24px;
      }
      #winner-overlay.active {
        display: flex;
        animation: fadeIn 0.6s ease;
      }
      .trophy {
        font-size: clamp(3rem, 10vw, 5rem);
        animation: trophy-anim 1s ease-out;
      }
      @keyframes trophy-anim {
        0% {
          transform: scale(0) rotate(-20deg);
          opacity: 0;
        }
        70% {
          transform: scale(1.2) rotate(5deg);
        }
        100% {
          transform: scale(1) rotate(0);
          opacity: 1;
        }
      }
      .winner-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(1.2rem, 4vw, 1.6rem);
        color: #fef08a;
      }
      .winner-scores {
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        color: #fef9e7;
      }
      .winner-actions {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        margin-top: 8px;
        width: 100%;
      }
      #winner-1v1-btns {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      #winner-king-btns {
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      .rematch-status-text {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        letter-spacing: 0.1em;
        color: #e8c97a;
        min-height: 1.2em;
        text-align: center;
      }

      /* ‚îÄ‚îÄ PEERJS ERROR ‚îÄ‚îÄ */
      #peerjs-error {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        color: #fde68a;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        text-align: center;
        padding: 10px 16px;
        background: rgba(139, 26, 26, 0.95);
        border-bottom: 1px solid #f87171;
        z-index: 900;
        letter-spacing: 0.08em;
      }
      #peerjs-error.active {
        display: block;
      }

      /* ‚îÄ‚îÄ TUTORIAL OVERLAY ‚îÄ‚îÄ */
      #tutorial-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.92);
        z-index: 600;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      #tutorial-overlay.active {
        display: flex;
        animation: fadeIn 0.4s ease;
      }
      .tutorial-box {
        border: 1px solid var(--gold);
        background: rgba(10, 8, 6, 0.97);
        box-shadow:
          0 0 40px rgba(201, 168, 76, 0.2),
          inset 0 0 20px rgba(0, 0, 0, 0.6);
        max-width: 560px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }
      .tutorial-header {
        padding: 20px 24px 16px;
        border-bottom: 1px solid rgba(201, 168, 76, 0.2);
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        background: rgba(10, 8, 6, 0.97);
        z-index: 1;
      }
      .tutorial-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        color: var(--gold);
      }
      .tutorial-close {
        background: transparent;
        border: 1px solid rgba(201, 168, 76, 0.4);
        color: var(--gold);
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.7rem;
        padding: 6px 12px;
        cursor: pointer;
        letter-spacing: 0.08em;
        transition: background 0.2s;
        flex-shrink: 0;
      }
      .tutorial-close:hover {
        background: rgba(201, 168, 76, 0.1);
      }
      .tutorial-body {
        padding: 20px 24px 24px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      .tutorial-section {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .tutorial-section-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.72rem, 2vw, 0.82rem);
        letter-spacing: 0.15em;
        color: var(--gold);
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .tutorial-section-title::after {
        content: "";
        flex: 1;
        height: 1px;
        background: linear-gradient(
          90deg,
          rgba(201, 168, 76, 0.4),
          transparent
        );
      }
      .tutorial-text {
        font-family: "Crimson Text", serif;
        font-size: clamp(0.95rem, 2.5vw, 1.05rem);
        color: rgba(232, 223, 200, 0.85);
        line-height: 1.7;
      }
      .tutorial-example {
        background: rgba(201, 168, 76, 0.06);
        border: 1px solid rgba(201, 168, 76, 0.15);
        border-left: 3px solid rgba(201, 168, 76, 0.5);
        padding: 12px 14px;
        font-family: "Crimson Text", serif;
        font-size: clamp(0.9rem, 2.5vw, 1rem);
        color: rgba(232, 223, 200, 0.75);
        line-height: 1.65;
      }
      .tutorial-example strong {
        color: var(--gold-light);
        font-style: italic;
      }
      .tutorial-example.cancel {
        border-left-color: rgba(248, 113, 113, 0.6);
        background: rgba(248, 113, 113, 0.04);
      }
      .tutorial-example.cancel strong {
        color: #fca5a5;
      }
      .tutorial-example.king {
        border-left-color: rgba(192, 132, 252, 0.6);
        background: rgba(192, 132, 252, 0.04);
      }
      .tutorial-example.king strong {
        color: #c084fc;
      }
      .tutorial-step {
        display: flex;
        gap: 12px;
        align-items: flex-start;
      }
      .tutorial-step-num {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.7rem;
        color: #0a0806;
        background: var(--gold);
        width: 22px;
        height: 22px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        margin-top: 2px;
        font-weight: 900;
      }
      .tutorial-step-text {
        font-family: "Crimson Text", serif;
        font-size: clamp(0.95rem, 2.5vw, 1.05rem);
        color: rgba(232, 223, 200, 0.85);
        line-height: 1.65;
      }
      .tutorial-modes-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .tutorial-mode-item {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(201, 168, 76, 0.15);
        padding: 10px 12px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .tutorial-mode-name {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.6rem, 1.6vw, 0.68rem);
        letter-spacing: 0.1em;
        color: var(--gold);
      }
      .tutorial-mode-desc {
        font-family: "Crimson Text", serif;
        font-size: clamp(0.85rem, 2.2vw, 0.95rem);
        color: rgba(232, 223, 200, 0.65);
        line-height: 1.5;
      }

      /* ‚îÄ‚îÄ KING ‚îÄ‚îÄ */
      .king-header {
        width: 100%;
        max-width: 860px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid rgba(201, 168, 76, 0.2);
        flex-wrap: wrap;
        gap: 8px;
      }
      .king-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.8rem, 2.5vw, 1rem);
        color: var(--gold);
      }
      .king-room-code {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        color: rgba(201, 168, 76, 0.75);
        letter-spacing: 0.15em;
      }
      .host-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.55rem, 1.5vw, 0.62rem);
        letter-spacing: 0.1em;
        color: #fef08a;
        background: rgba(201, 168, 76, 0.15);
        border: 1px solid rgba(201, 168, 76, 0.4);
        padding: 3px 10px;
        animation: hostPulse 2.5s ease-in-out infinite;
      }
      @keyframes hostPulse {
        0%,
        100% {
          box-shadow: 0 0 4px rgba(201, 168, 76, 0.3);
        }
        50% {
          box-shadow: 0 0 10px rgba(201, 168, 76, 0.6);
        }
      }
      .king-lobby-body {
        width: 100%;
        max-width: 860px;
        display: grid;
        grid-template-columns: 260px 1fr 260px;
        gap: 14px;
        align-items: start;
      }
      .king-panel {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(201, 168, 76, 0.15);
        padding: clamp(10px, 2.5vw, 16px);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .king-panel-title {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.6rem, 1.6vw, 0.68rem);
        letter-spacing: 0.2em;
        color: rgba(201, 168, 76, 0.75);
        margin-bottom: 4px;
        border-bottom: 1px solid rgba(201, 168, 76, 0.15);
        padding-bottom: 6px;
      }
      .current-match-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        padding: 8px 0;
      }
      .match-vs-row {
        display: flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        justify-content: center;
      }
      .match-player-name {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        color: var(--cream);
        text-align: center;
        flex: 1;
      }
      .match-vs {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.6rem;
        color: rgba(201, 168, 76, 0.4);
      }
      .match-score-row {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: center;
      }
      .match-score-val {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(1rem, 3vw, 1.2rem);
        color: var(--gold);
        min-width: 30px;
        text-align: center;
      }
      .match-score-sep {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.7rem;
        color: rgba(201, 168, 76, 0.3);
      }
      .player-card {
        background: rgba(0, 0, 0, 0.25);
        border: 1px solid rgba(201, 168, 76, 0.1);
        padding: 8px 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: border-color 0.2s;
        margin-bottom: 4px;
      }
      .player-card.playing {
        border-color: rgba(201, 168, 76, 0.5);
        background: rgba(201, 168, 76, 0.05);
      }
      .player-card.queued {
        border-color: rgba(139, 47, 201, 0.3);
        background: rgba(139, 47, 201, 0.03);
      }
      .player-card.spectating {
        opacity: 0.55;
      }
      .pc-position {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.9rem;
        color: rgba(201, 168, 76, 0.3);
        min-width: 20px;
        text-align: center;
      }
      .pc-position.active-pos {
        color: #fef08a;
        text-shadow: 0 0 10px rgba(254, 240, 138, 0.5);
      }
      .pc-name {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        color: var(--cream);
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .pc-name.is-me {
        color: var(--gold-light);
      }
      .pc-badge {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.6rem;
        letter-spacing: 0.08em;
        padding: 2px 6px;
        border-radius: 2px;
        white-space: nowrap;
      }
      .badge-playing {
        background: rgba(201, 168, 76, 0.2);
        color: #fef08a;
        border: 1px solid rgba(201, 168, 76, 0.4);
      }
      .badge-queued {
        background: rgba(139, 47, 201, 0.2);
        color: #c084fc;
        border: 1px solid rgba(139, 47, 201, 0.4);
      }
      .badge-spectating {
        background: rgba(107, 114, 128, 0.2);
        color: #9ca3af;
        border: 1px solid rgba(107, 114, 128, 0.3);
      }
      .badge-host {
        background: rgba(201, 168, 76, 0.25);
        color: #fef08a;
        border: 1px solid rgba(201, 168, 76, 0.5);
      }
      .ranking-row {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 8px;
        border-bottom: 1px solid rgba(201, 168, 76, 0.07);
      }
      .rank-pos {
        font-family: "Cinzel Decorative", cursive;
        font-size: 0.8rem;
        color: rgba(201, 168, 76, 0.4);
        min-width: 20px;
        text-align: center;
      }
      .rank-pos.gold-rank {
        color: #fef08a;
      }
      .rank-name {
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.65rem, 1.8vw, 0.75rem);
        color: var(--cream);
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .rank-name.is-me {
        color: var(--gold-light);
      }
      .king-actions-bar {
        width: 100%;
        max-width: 860px;
        display: flex;
        gap: 8px;
        justify-content: center;
      }
      .queue-mini-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 5px 4px;
        border-bottom: 1px solid rgba(201, 168, 76, 0.08);
      }
      .spectator-banner {
        width: 100%;
        max-width: 860px;
        text-align: center;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.6rem, 1.6vw, 0.68rem);
        letter-spacing: 0.12em;
        color: rgba(107, 114, 128, 0.8);
        padding: 6px;
        border: 1px dashed rgba(107, 114, 128, 0.3);
      }
      .host-warning-bar {
        width: 100%;
        max-width: 860px;
        background: rgba(201, 168, 76, 0.08);
        border: 1px solid rgba(201, 168, 76, 0.25);
        border-left: 3px solid rgba(201, 168, 76, 0.6);
        padding: 8px 14px;
        font-family: "Cinzel Decorative", cursive;
        font-size: clamp(0.55rem, 1.5vw, 0.62rem);
        letter-spacing: 0.08em;
        color: rgba(201, 168, 76, 0.8);
        text-align: center;
      }
      #screen-king-game {
        align-items: center;
      }
      .king-game-body {
        width: 100%;
        max-width: 860px;
        display: grid;
        grid-template-columns: 220px 1fr 220px;
        gap: 12px;
        align-items: start;
      }
      .king-side-panel {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(201, 168, 76, 0.15);
        padding: clamp(10px, 2.5vw, 14px);
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .king-center {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .king-queue-actions {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid rgba(201, 168, 76, 0.1);
      }
      #king-join-modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.88);
        z-index: 600;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 20px;
      }
      #king-join-modal.active {
        display: flex;
        animation: fadeIn 0.3s ease;
      }
      ::-webkit-scrollbar {
        width: 4px;
      }
      ::-webkit-scrollbar-track {
        background: var(--deep);
      }
      ::-webkit-scrollbar-thumb {
        background: var(--gold);
      }
      @media (max-width: 840px) {
        .lobby-modes {
          grid-template-columns: 1fr 1fr;
          max-width: 500px;
        }
        .king-lobby-body {
          grid-template-columns: 1fr;
          max-width: 400px;
        }
        .king-game-body {
          grid-template-columns: 1fr;
          max-width: 400px;
        }
        .king-header,
        .king-actions-bar,
        .host-warning-bar {
          max-width: 400px;
        }
      }
      @media (max-width: 520px) {
        .lobby-modes {
          grid-template-columns: 1fr;
          max-width: 340px;
        }
        .tutorial-modes-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (max-width: 380px) {
        .board-grid {
          gap: 4px;
        }
        .board-wrap {
          padding: 8px;
        }
      }
      @media (max-height: 700px) {
        #screen-game,
        #screen-king-game {
          padding-top: 6px;
          gap: 6px;
        }
        .turn-area {
          min-height: 80px;
        }
      }
    </style>
  </head>
  <body>
    <!-- ‚îÄ‚îÄ LANGUAGE SWITCHER ‚îÄ‚îÄ -->
    <div id="lang-switcher">
      <button class="lang-btn active" id="btn-ptbr" onclick="setLang('pt-BR')">
        PT-BR
      </button>
      <div class="lang-divider"></div>
      <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>

    <!-- ‚îÄ‚îÄ KO-FI BUTTON ‚îÄ‚îÄ -->
    <a
      id="kofi-btn"
      href="https://ko-fi.com/Z8Z41V7SQX"
      target="_blank"
      rel="noopener noreferrer"
      title="Support on Ko-fi"
    >
      <svg
        class="kofi-icon"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604 0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407 0 0 1.565-1.782 3.468-.963 1.904.82 1.832 2.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"
        />
      </svg>
      <span data-i18n="kofi">APOIAR</span>
    </a>

    <div id="toast"></div>
    <div id="peerjs-error" data-i18n-html="peerjsError">
      ‚ö† Erro ao carregar biblioteca P2P. Verifique sua conex√£o e recarregue a
      p√°gina.
    </div>

    <!-- ‚ïê‚ïê WINNER OVERLAY ‚ïê‚ïê -->
    <div id="winner-overlay">
      <div class="trophy" id="trophy-emoji">üèÜ</div>
      <div class="winner-title" id="winner-text"></div>
      <div class="winner-scores" id="winner-scores"></div>
      <div class="winner-actions">
        <div id="winner-1v1-btns">
          <button
            class="btn-gold"
            style="width: auto"
            onclick="requestRematch()"
          >
            ‚öî <span data-i18n="rematch">REVANCHE</span>
          </button>
          <div id="rematch-status" class="rematch-status-text"></div>
          <button
            id="rematch-btn-opp"
            class="btn-outline"
            style="width: auto; display: none; margin-top: 4px"
            onclick="acceptRematch()"
          >
            ‚úì <span data-i18n="acceptRematch">ACEITAR REVANCHE</span>
          </button>
        </div>
        <div id="winner-king-btns">
          <div id="king-next-match-msg" class="rematch-status-text"></div>
        </div>
        <button
          class="btn-outline sm"
          style="width: auto; margin-top: 4px"
          onclick="resetGame()"
        >
          ‚Üê <span data-i18n="leave">SAIR</span>
        </button>
      </div>
    </div>

    <!-- ‚ïê‚ïê TUTORIAL OVERLAY ‚ïê‚ïê -->
    <div id="tutorial-overlay">
      <div class="tutorial-box">
        <div class="tutorial-header">
          <div class="tutorial-title">
            üìñ <span data-i18n="howToPlay">COMO JOGAR</span>
          </div>
          <button class="tutorial-close" onclick="closeTutorial()">
            ‚úï <span data-i18n="close">FECHAR</span>
          </button>
        </div>
        <div class="tutorial-body" id="tutorial-body-content">
          <!-- filled dynamically by JS -->
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê KING JOIN MODAL ‚ïê‚ïê -->
    <div id="king-join-modal">
      <div
        style="
          font-family: &quot;Cinzel Decorative&quot;, cursive;
          font-size: 1.1rem;
          color: var(--gold);
          text-align: center;
        "
      >
        üëë <span data-i18n="joinRoom">ENTRAR NA SALA</span>
      </div>
      <div
        style="
          font-family: &quot;Cinzel Decorative&quot;, cursive;
          font-size: 0.75rem;
          color: rgba(201, 168, 76, 0.5);
          text-align: center;
          letter-spacing: 0.1em;
        "
        data-i18n="howJoin"
      >
        Como deseja participar?
      </div>
      <div
        style="display: flex; flex-direction: column; gap: 10px; width: 260px"
      >
        <button class="btn-king" onclick="confirmJoinKing(true)">
          ‚ôõ <span data-i18n="playJoinQueue">JOGAR ‚Äî ENTRAR NA FILA</span>
        </button>
        <button class="btn-outline" onclick="confirmJoinKing(false)">
          üëÅ <span data-i18n="watchOnly">S√ì ASSISTIR</span>
        </button>
        <button
          class="btn-outline sm"
          onclick="closeKingModal()"
          style="opacity: 0.5; margin-top: 4px"
          data-i18n="cancel"
        >
          CANCELAR
        </button>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOBBY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-lobby" class="screen active">
      <div style="text-align: center">
        <div class="title-sub">
          ‚öî <span data-i18n="dicegame">JOGO DE DADOS</span> ‚öî
        </div>
        <h1 class="title-main">KNUCKLE<br />BONES</h1>
        <div class="ornament" style="margin-top: 16px">‚ú¶</div>
      </div>
      <div class="lobby-name-section">
        <div class="field-label" data-i18n="yourName">SEU NOME</div>
        <input
          id="player-name"
          type="text"
          maxlength="16"
          class="game-input"
          data-i18n-placeholder="namePlaceholder"
          placeholder="Como voc√™ se chama?"
        />
      </div>
      <div class="lobby-modes">
        <!-- 1v1 -->
        <div class="mode-card">
          <div class="mode-card-icon">‚öî</div>
          <div class="mode-card-title" data-i18n="mode1v1">1 VS 1 PRIVADO</div>
          <div class="mode-card-desc" data-i18n="mode1v1Desc">
            Crie uma sala e envie o c√≥digo para um amigo entrar
          </div>
          <button class="btn-gold" onclick="createRoom()">
            ‚ú¶ <span data-i18n="createRoom">CRIAR SALA</span>
          </button>
        </div>
        <!-- JOIN -->
        <div class="mode-card join">
          <div class="mode-card-icon">üö™</div>
          <div class="mode-card-title" data-i18n="modeJoin">ENTRAR NA SALA</div>
          <div class="mode-card-desc" data-i18n="modeJoinDesc">
            Cole o c√≥digo recebido ‚Äî funciona para qualquer modo
          </div>
          <input
            id="join-code"
            type="text"
            maxlength="8"
            class="game-input code-style"
            data-i18n-placeholder="roomCodePlaceholder"
            placeholder="C√ìDIGO DA SALA"
          />
          <button class="btn-gold" onclick="joinAnyRoom()">
            ‚Üí <span data-i18n="enter">ENTRAR</span>
          </button>
        </div>
        <!-- KING -->
        <div class="mode-card king">
          <div class="mode-card-icon">üëë</div>
          <div class="mode-card-title" data-i18n="modeKing">REI DA MESA</div>
          <div class="mode-card-desc" data-i18n="modeKingDesc">
            At√© 8 jogadores. Vencedor fica, perdedor vai para o fim da fila
          </div>
          <button class="btn-king" onclick="createKingRoom()">
            ‚ôõ <span data-i18n="createRoom">CRIAR SALA</span>
          </button>
        </div>
        <!-- 2v2 COMING SOON -->
        <div class="mode-card coming-soon">
          <div class="mode-card-icon">üõ°</div>
          <div class="mode-card-title" data-i18n="mode2v2">2 VS 2</div>
          <div class="mode-card-desc" data-i18n="mode2v2Desc">
            Forme duplas e ven√ßa em equipe
          </div>
          <div class="coming-soon-badge" data-i18n="comingSoon">EM BREVE</div>
        </div>
        <!-- BOT -->
        <div class="mode-card bot">
          <div class="mode-card-icon">ü§ñ</div>
          <div class="mode-card-title" data-i18n="modeBot">VS BOT</div>
          <div class="mode-card-desc" data-i18n="modeBotDesc">
            Treine contra intelig√™ncia artificial
          </div>
          <select id="bot-difficulty" class="bot-difficulty-select">
            <option value="easy" data-i18n="easy">üé≤ F√°cil</option>
            <option value="medium" selected data-i18n="medium">‚öî M√©dio</option>
            <option value="hard" data-i18n="hard">üíÄ Dif√≠cil</option>
          </select>
          <button class="btn-bot" onclick="startBotGame()">
            ‚ú¶ <span data-i18n="play">JOGAR</span>
          </button>
        </div>
        <!-- TUTORIAL -->
        <div class="mode-card tutorial-card" onclick="openTutorial()">
          <div class="mode-card-icon">üìñ</div>
          <div class="mode-card-title" data-i18n="howToPlay">COMO JOGAR</div>
          <div class="mode-card-desc" data-i18n="howToPlayDesc">
            Aprenda as regras, o multiplicador e o cancelamento
          </div>
          <button
            class="btn-sky"
            onclick="
              openTutorial();
              event.stopPropagation();
            "
          >
            ‚Üí <span data-i18n="seeRules">VER REGRAS</span>
          </button>
        </div>
      </div>
      <div class="ornament" style="max-width: 780px">‚ú¶</div>
      <p class="hint-text" data-i18n="p2pHint">
        Jogo P2P ‚Äî compartilhe o c√≥digo com seus amigos.
      </p>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WAITING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-waiting" class="screen">
      <div class="waiting-title cinzel" data-i18n="roomCreated">
        SALA CRIADA
      </div>
      <div class="panel panel-center">
        <div class="waiting-label" data-i18n="roomCode">C√ìDIGO DA SALA</div>
        <div class="room-code-display" id="display-room-code"></div>
        <button class="btn-outline" onclick="copyCode()">
          üìã <span data-i18n="copyCode">COPIAR C√ìDIGO</span>
        </button>
        <div class="ornament">‚ú¶</div>
        <div class="status-msg" style="color: rgba(201, 168, 76, 0.7)">
          <span class="dot dot-yellow"></span
          ><span data-i18n="waitingOpponent"
            >Aguardando oponente entrar...</span
          >
        </div>
      </div>
      <button
        class="btn-outline sm"
        style="width: auto"
        onclick="backToLobby()"
      >
        ‚Üê <span data-i18n="back">VOLTAR</span>
      </button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 1V1 GAME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-game" class="screen">
      <div class="game-header">
        <span class="game-header-label">KNUCKLEBONES</span>
        <span class="game-header-label" id="room-label"></span>
      </div>
      <div class="board-section">
        <div class="player-row">
          <div class="player-name-wrap">
            <span class="dot dot-green" id="opp-dot"></span>
            <span class="player-name" id="opp-name-display" data-i18n="opponent"
              >Oponente</span
            >
          </div>
          <span class="score-display" id="opp-score">0</span>
        </div>
        <div class="board-wrap">
          <div class="board-grid" id="opp-board"></div>
        </div>
      </div>
      <div class="turn-area">
        <div class="turn-status" id="turn-status"></div>
        <div id="rolling-die-container"></div>
        <div class="sub-status" id="sub-status"></div>
      </div>
      <div class="board-section">
        <div class="board-wrap">
          <div class="board-grid" id="my-board"></div>
        </div>
        <div class="player-row bottom">
          <div class="player-name-wrap">
            <span class="dot dot-green" id="my-dot"></span>
            <span class="player-name" id="my-name-display" data-i18n="you"
              >Voc√™</span
            >
          </div>
          <span class="score-display" id="my-score">0</span>
        </div>
      </div>
      <button
        class="btn-outline sm"
        style="width: auto; margin-top: 4px"
        onclick="backToLobby()"
      >
        ‚Üê <span data-i18n="leave">SAIR</span>
      </button>
      <div class="rules-hint" data-i18n="rulesHint">
        DADOS IGUAIS NA MESMA COLUNA MULTIPLICAM ‚Ä¢ MESMO N√öM. CANCELA DO
        OPONENTE
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KING LOBBY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-king-lobby" class="screen">
      <div class="king-header">
        <div
          style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap"
        >
          <div class="king-title">
            üëë <span data-i18n="modeKing">REI DA MESA</span>
          </div>
          <div id="king-host-badge" style="display: none" class="host-badge">
            ‚≠ê
            <span data-i18n="hostWarningShort"
              >VOC√ä √â O HOST ‚Äî N√ÉO FECHE ESTA ABA</span
            >
          </div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px">
          <div class="king-room-code" id="king-room-label"></div>
          <button
            class="btn-outline sm"
            style="width: auto"
            onclick="copyKingCode()"
          >
            üìã
          </button>
        </div>
      </div>
      <div
        id="king-host-warning"
        class="host-warning-bar"
        style="display: none"
        data-i18n="hostWarningFull"
      >
        ‚ö† Voc√™ √© o host desta sala. Se fechar esta aba, todos os jogadores ser√£o
        desconectados.
      </div>
      <div class="king-lobby-body">
        <div class="king-panel">
          <div class="king-panel-title">
            ‚öî <span data-i18n="players">JOGADORES</span>
          </div>
          <div id="king-player-list"></div>
        </div>
        <div style="display: flex; flex-direction: column; gap: 12px">
          <div class="king-panel">
            <div class="king-panel-title" data-i18n="currentMatch">
              PARTIDA ATUAL
            </div>
            <div class="current-match-info" id="king-current-match-info">
              <span
                style="
                  font-family: &quot;Cinzel Decorative&quot;, cursive;
                  font-size: 0.75rem;
                  color: rgba(201, 168, 76, 0.3);
                "
                data-i18n="waiting"
                >Aguardando...</span
              >
            </div>
          </div>
          <div class="king-panel">
            <div class="king-panel-title">
              ‚è≥ <span data-i18n="waitQueue">FILA DE ESPERA</span>
            </div>
            <div id="king-queue-display"></div>
          </div>
        </div>
        <div class="king-panel">
          <div class="king-panel-title">
            üèÜ <span data-i18n="ranking">RANKING</span>
          </div>
          <div id="king-ranking-list"></div>
        </div>
      </div>
      <div class="king-actions-bar">
        <button
          class="btn-king queue-btn"
          id="king-join-queue-btn"
          onclick="kingJoinQueue()"
          style="display: none"
        >
          ‚ôõ <span data-i18n="joinQueue">ENTRAR NA FILA</span>
        </button>
        <button
          class="btn-outline sm queue-btn"
          id="king-leave-queue-btn"
          onclick="kingLeaveQueue()"
          style="display: none"
        >
          ‚úï <span data-i18n="leaveQueue">SAIR DA FILA</span>
        </button>
      </div>
      <button
        class="btn-outline sm"
        style="width: auto"
        onclick="backToLobby()"
      >
        ‚Üê <span data-i18n="leaveRoom">SAIR DA SALA</span>
      </button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KING GAME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-king-game" class="screen">
      <div class="game-header" style="max-width: 860px">
        <span class="game-header-label"
          >üëë <span data-i18n="modeKing">REI DA MESA</span></span
        >
        <span class="game-header-label" id="king-room-label-game"></span>
      </div>
      <div
        id="king-spectator-banner"
        class="spectator-banner"
        style="display: none"
      ></div>
      <div class="king-game-body">
        <div class="king-side-panel">
          <div class="king-panel-title">
            ‚è≥ <span data-i18n="waitQueue">FILA DE ESPERA</span>
          </div>
          <div id="king-queue-mini"></div>
          <div class="king-queue-actions">
            <button
              class="btn-king queue-btn"
              id="king-game-join-btn"
              onclick="kingJoinQueue()"
              style="display: none"
            >
              ‚ôõ <span data-i18n="joinQueue">ENTRAR NA FILA</span>
            </button>
            <button
              class="btn-outline sm queue-btn"
              id="king-game-leave-btn"
              onclick="kingLeaveQueue()"
              style="display: none"
            >
              ‚úï <span data-i18n="leaveQueue">SAIR DA FILA</span>
            </button>
          </div>
        </div>
        <div class="king-center">
          <div class="board-section" style="max-width: 340px">
            <div class="player-row">
              <div class="player-name-wrap">
                <span class="dot dot-green"></span
                ><span
                  class="player-name"
                  id="king-opp-name"
                  data-i18n="opponent"
                  >Oponente</span
                >
              </div>
              <span class="score-display" id="king-opp-score">0</span>
            </div>
            <div class="board-wrap">
              <div class="board-grid" id="king-opp-board"></div>
            </div>
          </div>
          <div class="turn-area">
            <div class="turn-status" id="king-turn-status"></div>
            <div id="king-rolling-die"></div>
            <div class="sub-status" id="king-sub-status"></div>
          </div>
          <div class="board-section" style="max-width: 340px">
            <div class="board-wrap">
              <div class="board-grid" id="king-my-board"></div>
            </div>
            <div class="player-row bottom">
              <div class="player-name-wrap">
                <span class="dot dot-green"></span
                ><span class="player-name" id="king-my-name" data-i18n="you"
                  >Voc√™</span
                >
              </div>
              <span class="score-display" id="king-my-score">0</span>
            </div>
          </div>
          <button
            class="btn-outline sm"
            onclick="backToLobby()"
            style="width: auto; margin-top: 4px"
          >
            ‚Üê <span data-i18n="leave">SAIR</span>
          </button>
          <div
            class="rules-hint"
            style="max-width: 340px"
            data-i18n="kingRulesHint"
          >
            VENCEDOR FICA ‚Ä¢ PERDEDOR VAI PARA O FIM DA FILA
          </div>
        </div>
        <div class="king-side-panel">
          <div class="king-panel-title">
            üèÜ <span data-i18n="ranking">RANKING</span>
          </div>
          <div id="king-ranking-mini"></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // i18n SYSTEM
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const I18N = {
        "pt-BR": {
          // ui labels
          kofi: "APOIAR",
          yourName: "SEU NOME",
          namePlaceholder: "Como voc√™ se chama?",
          roomCodePlaceholder: "C√ìDIGO DA SALA",
          dicegame: "JOGO DE DADOS",
          howToPlay: "COMO JOGAR",
          howToPlayDesc: "Aprenda as regras, o multiplicador e o cancelamento",
          seeRules: "VER REGRAS",
          close: "FECHAR",
          // modes
          mode1v1: "1 VS 1 PRIVADO",
          mode1v1Desc: "Crie uma sala e envie o c√≥digo para um amigo entrar",
          modeJoin: "ENTRAR NA SALA",
          modeJoinDesc: "Cole o c√≥digo recebido ‚Äî funciona para qualquer modo",
          modeKing: "REI DA MESA",
          modeKingDesc:
            "At√© 8 jogadores. Vencedor fica, perdedor vai para o fim da fila",
          mode2v2: "2 VS 2",
          mode2v2Desc: "Forme duplas e ven√ßa em equipe",
          comingSoon: "EM BREVE",
          modeBot: "VS BOT",
          modeBotDesc: "Treine contra intelig√™ncia artificial",
          easy: "üé≤ F√°cil",
          medium: "‚öî M√©dio",
          hard: "üíÄ Dif√≠cil",
          play: "JOGAR",
          // buttons
          createRoom: "CRIAR SALA",
          enter: "ENTRAR",
          copyCode: "COPIAR C√ìDIGO",
          back: "VOLTAR",
          leave: "SAIR",
          cancel: "CANCELAR",
          leaveRoom: "SAIR DA SALA",
          joinRoom: "ENTRAR NA SALA",
          howJoin: "Como deseja participar?",
          playJoinQueue: "JOGAR ‚Äî ENTRAR NA FILA",
          watchOnly: "S√ì ASSISTIR",
          rematch: "REVANCHE",
          acceptRematch: "ACEITAR REVANCHE",
          joinQueue: "ENTRAR NA FILA",
          leaveQueue: "SAIR DA FILA",
          // game states
          roomCreated: "SALA CRIADA",
          roomCode: "C√ìDIGO DA SALA",
          waitingOpponent: "Aguardando oponente entrar...",
          opponent: "Oponente",
          you: "Voc√™",
          yourTurn: "‚ñº Sua vez",
          chooseCol: "‚ñº Escolha uma coluna",
          opponentTurn: "Vez de ",
          opponentChoosing: " est√° escolhendo...",
          fullCol: "Coluna cheia!",
          vsComputer: "VS COMPUTADOR",
          // king
          players: "JOGADORES",
          currentMatch: "PARTIDA ATUAL",
          waiting: "Aguardando...",
          waitingPlayers: "Aguardando jogadores...",
          waitQueue: "FILA DE ESPERA",
          emptyQueue: "Fila vazia",
          ranking: "RANKING",
          hostWarningShort: "VOC√ä √â O HOST ‚Äî N√ÉO FECHE ESTA ABA",
          hostWarningFull:
            "‚ö† Voc√™ √© o host desta sala. Se fechar esta aba, todos os jogadores ser√£o desconectados.",
          nextMatch: "Pr√≥xima partida em breve...",
          watching: "üëÅ ASSISTINDO",
          spectatingQueue: "‚è≥ FILA ‚Äî Posi√ß√£o ",
          spectatingWatching: " ‚Ä¢ Assistindo",
          watchingJoinHint: "üëÅ ASSISTINDO ‚Äî Entre na fila para jogar",
          queueFull: "Fila cheia (m√°x ",
          watching2: "Assistindo",
          rolling: " rolou ",
          // badges
          badgePlaying: "JOGANDO",
          badgeQueue: "FILA",
          badgeSpectating: "ASSISTINDO",
          badgeHost: "HOST",
          // game over
          won: " VENCEU!",
          tie: "EMPATE!",
          // rules hints
          rulesHint:
            "DADOS IGUAIS NA MESMA COLUNA MULTIPLICAM ‚Ä¢ MESMO N√öM. CANCELA DO OPONENTE",
          kingRulesHint: "VENCEDOR FICA ‚Ä¢ PERDEDOR VAI PARA O FIM DA FILA",
          p2pHint: "Jogo P2P ‚Äî compartilhe o c√≥digo com seus amigos.",
          // errors
          peerjsError:
            "‚ö† Erro ao carregar biblioteca P2P. Verifique sua conex√£o e recarregue a p√°gina.",
          typeName: "Digite seu nome",
          typeCode: "Digite o c√≥digo",
          codeCopied: "C√≥digo copiado!",
          checking: "Verificando sala...",
          roomNotFound: "Sala n√£o encontrada",
          hostDisconnected: "Host desconectou",
          oppDisconnected: "Oponente desconectou",
          returningMenu: "Voltando ao menu em ",
          waitingFor: "Aguardando ",
          p2pLoading: "Biblioteca P2P carregando...",
          roomLabel: "Sala: ",
          // tutorial keys handled by renderTutorial()
        },
        en: {
          kofi: "SUPPORT",
          yourName: "YOUR NAME",
          namePlaceholder: "What's your name?",
          roomCodePlaceholder: "ROOM CODE",
          dicegame: "DICE GAME",
          howToPlay: "HOW TO PLAY",
          howToPlayDesc: "Learn the rules, multiplier and cancellation",
          seeRules: "SEE RULES",
          close: "CLOSE",
          mode1v1: "1 VS 1 PRIVATE",
          mode1v1Desc: "Create a room and share the code with a friend",
          modeJoin: "JOIN ROOM",
          modeJoinDesc: "Paste the code you received ‚Äî works for any mode",
          modeKing: "KING OF THE TABLE",
          modeKingDesc:
            "Up to 8 players. Winner stays, loser goes to the back of the queue",
          mode2v2: "2 VS 2",
          mode2v2Desc: "Form teams and win together",
          comingSoon: "COMING SOON",
          modeBot: "VS BOT",
          modeBotDesc: "Train against artificial intelligence",
          easy: "üé≤ Easy",
          medium: "‚öî Medium",
          hard: "üíÄ Hard",
          play: "PLAY",
          createRoom: "CREATE ROOM",
          enter: "JOIN",
          copyCode: "COPY CODE",
          back: "BACK",
          leave: "LEAVE",
          cancel: "CANCEL",
          leaveRoom: "LEAVE ROOM",
          joinRoom: "JOIN ROOM",
          howJoin: "How do you want to join?",
          playJoinQueue: "PLAY ‚Äî JOIN QUEUE",
          watchOnly: "SPECTATE ONLY",
          rematch: "REMATCH",
          acceptRematch: "ACCEPT REMATCH",
          joinQueue: "JOIN QUEUE",
          leaveQueue: "LEAVE QUEUE",
          roomCreated: "ROOM CREATED",
          roomCode: "ROOM CODE",
          waitingOpponent: "Waiting for opponent...",
          opponent: "Opponent",
          you: "You",
          yourTurn: "‚ñº Your turn",
          chooseCol: "‚ñº Choose a column",
          opponentTurn: "Turn: ",
          opponentChoosing: " is choosing...",
          fullCol: "Column full!",
          vsComputer: "VS COMPUTER",
          players: "PLAYERS",
          currentMatch: "CURRENT MATCH",
          waiting: "Waiting...",
          waitingPlayers: "Waiting for players...",
          waitQueue: "QUEUE",
          emptyQueue: "Queue is empty",
          ranking: "RANKING",
          hostWarningShort: "YOU'RE THE HOST ‚Äî DON'T CLOSE THIS TAB",
          hostWarningFull:
            "‚ö† You are the host of this room. If you close this tab, all players will be disconnected.",
          nextMatch: "Next match coming soon...",
          watching: "üëÅ SPECTATING",
          spectatingQueue: "‚è≥ QUEUE ‚Äî Position ",
          spectatingWatching: " ‚Ä¢ Spectating",
          watchingJoinHint: "üëÅ SPECTATING ‚Äî Join the queue to play",
          queueFull: "Queue full (max ",
          watching2: "Spectating",
          rolling: " rolled ",
          badgePlaying: "PLAYING",
          badgeQueue: "QUEUE",
          badgeSpectating: "WATCHING",
          badgeHost: "HOST",
          won: " WON!",
          tie: "DRAW!",
          rulesHint:
            "SAME DICE IN A COLUMN MULTIPLY ‚Ä¢ SAME NUMBER CANCELS OPPONENT'S",
          kingRulesHint: "WINNER STAYS ‚Ä¢ LOSER GOES TO BACK OF QUEUE",
          p2pHint: "P2P game ‚Äî share the code with your friends.",
          peerjsError:
            "‚ö† Error loading P2P library. Check your connection and reload the page.",
          typeName: "Enter your name",
          typeCode: "Enter the code",
          codeCopied: "Code copied!",
          checking: "Checking room...",
          roomNotFound: "Room not found",
          hostDisconnected: "Host disconnected",
          oppDisconnected: "Opponent disconnected",
          returningMenu: "Returning to menu in ",
          waitingFor: "Waiting for ",
          p2pLoading: "P2P library loading...",
          roomLabel: "Room: ",
        },
      };

      let currentLang = "pt-BR";

      function t(key) {
        return (
          (I18N[currentLang] && I18N[currentLang][key]) ||
          (I18N["pt-BR"] && I18N["pt-BR"][key]) ||
          key
        );
      }

      function applyTranslations() {
        // data-i18n: set textContent
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.getAttribute("data-i18n");
          el.textContent = t(key);
        });
        // data-i18n-html: set innerHTML
        document.querySelectorAll("[data-i18n-html]").forEach((el) => {
          const key = el.getAttribute("data-i18n-html");
          el.innerHTML = t(key);
        });
        // data-i18n-placeholder
        document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
          const key = el.getAttribute("data-i18n-placeholder");
          el.placeholder = t(key);
        });
        // update bot difficulty options
        const sel = document.getElementById("bot-difficulty");
        if (sel) {
          Array.from(sel.options).forEach((opt) => {
            const key = opt.getAttribute("data-i18n");
            if (key) opt.textContent = t(key);
          });
        }
        // update html lang attr
        document.getElementById("html-root").lang = currentLang;
        // update lang switcher active state
        document
          .getElementById("btn-ptbr")
          .classList.toggle("active", currentLang === "pt-BR");
        document
          .getElementById("btn-en")
          .classList.toggle("active", currentLang === "en");
        // re-render tutorial
        renderTutorial();
      }

      function setLang(lang) {
        currentLang = lang;
        // update URL without reload (may fail in sandboxed iframes ‚Äî safe to ignore)
        try {
          const url = new URL(window.location.href);
          url.searchParams.set("lang", lang === "pt-BR" ? "pt-br" : "en");
          history.replaceState({}, "", url.toString());
        } catch (e) {}
        applyTranslations();
      }

      // ‚îÄ‚îÄ Read lang from URL on load ‚îÄ‚îÄ
      (function () {
        const url = new URL(window.location.href);
        // Support path-based: /en or /pt-br
        const path = window.location.pathname.replace(/\/$/, "");
        if (path.endsWith("/en") || url.searchParams.get("lang") === "en") {
          currentLang = "en";
        } else if (
          path.endsWith("/pt-br") ||
          url.searchParams.get("lang") === "pt-br"
        ) {
          currentLang = "pt-BR";
        } else {
          // auto-detect browser language
          const nav = navigator.language || "";
          if (nav.toLowerCase().startsWith("pt")) currentLang = "pt-BR";
          else if (nav.toLowerCase().startsWith("en")) currentLang = "en";
        }
      })();

      // ‚îÄ‚îÄ TUTORIAL content (i18n aware) ‚îÄ‚îÄ
      function renderTutorial() {
        const body = document.getElementById("tutorial-body-content");
        if (!body) return;
        if (currentLang === "en") {
          body.innerHTML = `
          <div class="tutorial-section">
            <div class="tutorial-section-title">üéØ OBJECTIVE</div>
            <p class="tutorial-text">Have more points than your opponent when one of the boards is completely filled. The game ends immediately when this happens.</p>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üé≤ HOW A ROUND WORKS</div>
            <div class="tutorial-step"><div class="tutorial-step-num">1</div><div class="tutorial-step-text">A die is automatically rolled for you ‚Äî the value is revealed and floats on screen.</div></div>
            <div class="tutorial-step"><div class="tutorial-step-num">2</div><div class="tutorial-step-text">Choose which of the 3 columns on your board to place the die. Click the desired column.</div></div>
            <div class="tutorial-step"><div class="tutorial-step-num">3</div><div class="tutorial-step-text">The die is stacked in the column ‚Äî each column holds up to 3 dice. Full columns are unavailable.</div></div>
            <div class="tutorial-step"><div class="tutorial-step-num">4</div><div class="tutorial-step-text">The turn passes to the opponent, who does the same. Turns alternate until the board fills up.</div></div>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">‚ú® MULTIPLIER ‚Äî THE MAIN RULE</div>
            <p class="tutorial-text">Equal dice in the <em>same column</em> multiply their value. The more repetitions, the bigger the bonus:</p>
            <div class="tutorial-example">
              <strong>1 die of value 4</strong> in the column ‚Üí worth 4 points (4 √ó 1¬≤)<br/>
              <strong>2 dice of value 4</strong> in the column ‚Üí worth 32 points (4 √ó 2¬≤)<br/>
              <strong>3 dice of value 4</strong> in the column ‚Üí worth 48 points (4 √ó 3¬≤)<br/><br/>
              <em>Three 6s in the same column? That's <strong>54 points</strong> from just that column!</em>
            </div>
            <p class="tutorial-text">Each column's points are displayed next to it in real time. The total score is shown next to your name.</p>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üí• CANCELLATION ‚Äî THE DEFENSIVE TACTIC</div>
            <p class="tutorial-text">When placing a die in a column, <em>all</em> dice with the same value are removed from the same column on the opponent's board.</p>
            <div class="tutorial-example cancel">
              Your opponent has two <strong>5s</strong> in the middle column (worth 50 pts).<br/>
              You place a <strong>5</strong> in the middle column ‚Äî the opponent's dice <strong>disappear</strong>.<br/>
              You just destroyed 50 points with one move!
            </div>
            <p class="tutorial-text">Cancellation is instant and requires no extra action. This creates a constant dilemma: do I maximize my score or sabotage the opponent?</p>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üëë GAME MODES</div>
            <div class="tutorial-modes-grid">
              <div class="tutorial-mode-item"><div class="tutorial-mode-name">‚öî 1 VS 1 PRIVATE</div><div class="tutorial-mode-desc">Create a room, share the code with a friend. Rematch available after the game.</div></div>
              <div class="tutorial-mode-item"><div class="tutorial-mode-name">ü§ñ VS BOT</div><div class="tutorial-mode-desc">Train against AI in 3 difficulties. Great for learning mechanics without pressure.</div></div>
              <div class="tutorial-mode-item" style="border-color:rgba(192,132,252,.2)"><div class="tutorial-mode-name" style="color:rgba(192,132,252,.85)">üëë KING OF THE TABLE</div><div class="tutorial-mode-desc">Up to 8 players in queue. Winner stays, loser goes to the back of the queue.</div></div>
              <div class="tutorial-mode-item" style="opacity:.5"><div class="tutorial-mode-name">üö™ JOIN ROOM</div><div class="tutorial-mode-desc">Use a received code to enter any active room ‚Äî 1v1 or King of the Table.</div></div>
            </div>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üí° QUICK TIPS</div>
            <div class="tutorial-example">
              ‚Ä¢ Prioritize high dice (5, 6) for columns where you already have the same value ‚Äî the multiplier is very rewarding.<br/>
              ‚Ä¢ Keep an eye on the opponent's columns. Sometimes canceling is worth more than building.<br/>
            </div>
          </div>`;
        } else {
          body.innerHTML = `
          <div class="tutorial-section">
            <div class="tutorial-section-title">üéØ OBJETIVO</div>
            <p class="tutorial-text">Tenha mais pontos que seu oponente quando um dos tabuleiros estiver completamente preenchido. O jogo termina imediatamente quando isso acontece.</p>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üé≤ COMO FUNCIONA UMA RODADA</div>
            <div class="tutorial-step"><div class="tutorial-step-num">1</div><div class="tutorial-step-text">Um dado √© rolado automaticamente para voc√™ ‚Äî o valor √© revelado e fica flutuando na tela.</div></div>
            <div class="tutorial-step"><div class="tutorial-step-num">2</div><div class="tutorial-step-text">Escolha em qual das 3 colunas do seu tabuleiro colocar o dado. Clique na coluna desejada.</div></div>
            <div class="tutorial-step"><div class="tutorial-step-num">3</div><div class="tutorial-step-text">O dado √© empilhado na coluna ‚Äî cada coluna comporta at√© 3 dados. Colunas cheias ficam indispon√≠veis.</div></div>
            <div class="tutorial-step"><div class="tutorial-step-num">4</div><div class="tutorial-step-text">A vez passa para o oponente, que faz o mesmo processo. O turno alterna at√© o tabuleiro lotar.</div></div>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">‚ú® MULTIPLICADOR ‚Äî A REGRA PRINCIPAL</div>
            <p class="tutorial-text">Dados iguais na <em>mesma coluna</em> multiplicam seu valor. Quanto mais repeti√ß√µes, maior o b√¥nus:</p>
            <div class="tutorial-example">
              <strong>1 dado de valor 4</strong> na coluna ‚Üí vale 4 pontos (4 √ó 1¬≤)<br/>
              <strong>2 dados de valor 4</strong> na coluna ‚Üí valem 32 pontos (4 √ó 2¬≤)<br/>
              <strong>3 dados de valor 4</strong> na coluna ‚Üí valem 48 pontos (4 √ó 3¬≤)<br/><br/>
              <em>Tr√™s 6s na mesma coluna? S√£o <strong>54 pontos</strong> s√≥ nessa coluna!</em>
            </div>
            <p class="tutorial-text">Os pontos de cada coluna s√£o exibidos ao lado dela em tempo real. A pontua√ß√£o total fica no canto ao lado do seu nome.</p>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üí• CANCELAMENTO ‚Äî A T√ÅTICA DE DEFESA</div>
            <p class="tutorial-text">Ao colocar um dado em uma coluna, <em>todos</em> os dados com o mesmo valor s√£o removidos da mesma coluna do oponente.</p>
            <div class="tutorial-example cancel">
              Seu oponente tem dois <strong>5s</strong> na coluna do meio (vale 50 pts).<br/>
              Voc√™ coloca um <strong>5</strong> na coluna do meio ‚Äî os dados do oponente <strong>desaparecem</strong>.<br/>
              Voc√™ destruiu 50 pontos do oponente com uma jogada!
            </div>
            <p class="tutorial-text">O cancelamento √© instant√¢neo e n√£o exige a√ß√£o extra. Isso cria um dilema constante: maximizo minha pontua√ß√£o ou saboto o oponente?</p>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üëë MODOS DE JOGO</div>
            <div class="tutorial-modes-grid">
              <div class="tutorial-mode-item"><div class="tutorial-mode-name">‚öî 1 VS 1 PRIVADO</div><div class="tutorial-mode-desc">Crie uma sala, envie o c√≥digo para um amigo entrar. Revanche dispon√≠vel ap√≥s a partida.</div></div>
              <div class="tutorial-mode-item"><div class="tutorial-mode-name">ü§ñ VS BOT</div><div class="tutorial-mode-desc">Treine contra IA em 3 dificuldades. Ideal para aprender as mec√¢nicas sem press√£o.</div></div>
              <div class="tutorial-mode-item" style="border-color:rgba(192,132,252,.2)"><div class="tutorial-mode-name" style="color:rgba(192,132,252,.85)">üëë REI DA MESA</div><div class="tutorial-mode-desc">At√© 8 jogadores em fila. Vencedor permanece jogando, perdedor vai para o fim da fila.</div></div>
              <div class="tutorial-mode-item" style="opacity:.5"><div class="tutorial-mode-name">üö™ ENTRAR NA SALA</div><div class="tutorial-mode-desc">Use um c√≥digo recebido para entrar em qualquer sala ativa ‚Äî 1v1 ou Rei da Mesa.</div></div>
            </div>
          </div>
          <div class="tutorial-section">
            <div class="tutorial-section-title">üí° DICAS R√ÅPIDAS</div>
            <div class="tutorial-example">
              ‚Ä¢ Priorize dados altos (5, 6) para colunas onde j√° tem o mesmo valor ‚Äî o multiplicador compensa muito.<br/>
              ‚Ä¢ Fique de olho nas colunas do oponente. √Äs vezes cancelar vale mais do que construir.<br/>
            </div>
          </div>`;
        }
      }
    </script>

    <script>
      (function () {
        var s = document.createElement("script");
        s.src = "https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js";
        s.onerror = function () {
          var f = document.createElement("script");
          f.src =
            "https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js";
          f.onerror = function () {
            document.getElementById("peerjs-error").classList.add("active");
          };
          document.body.appendChild(f);
        };
        document.body.appendChild(s);
      })();
    </script>
    <script src="knucklebones-bot.js"></script>
    <script>
      const COLS = 3,
        ROWS = 3;
      const KING_MAX_QUEUE = 8;

      let myName = "",
        oppName = "",
        myBoard = [],
        oppBoard = [],
        myTurn = false,
        currentDie = null;
      let peer = null,
        conn = null,
        isHost = false,
        roomCode = "",
        gameStarted = false,
        rematchRequestedByMe = false;
      let kingMode = false,
        kingIsHost = false,
        kingRoomCode = "",
        kingMyId = "",
        kingMyName = "";
      let kingPeer = null,
        kingHostConn = null,
        kingPeerConns = {},
        kingState = null;
      let kingHostSlot = -1,
        kingHostDie = null;
      let kgGuestMySlot = -1,
        kgGuestDie = null,
        kgGuestMyTurnFlag = false;
      let _pendingKingCode = "";
      let _kingNextGameTimeout = null,
        _kingOverlayTimeout = null;
      let botMode = false,
        botPendingTimeout = null;
      let botDifficulty = "medium";

      // ‚îÄ‚îÄ SAVE NAME ‚îÄ‚îÄ
      (function () {
        const saved = localStorage.getItem("kb_player_name");
        if (saved) document.getElementById("player-name").value = saved;
      })();
      document
        .getElementById("player-name")
        .addEventListener("input", function () {
          localStorage.setItem("kb_player_name", this.value);
        });

      // ‚îÄ‚îÄ TUTORIAL ‚îÄ‚îÄ
      function openTutorial() {
        document.getElementById("tutorial-overlay").classList.add("active");
      }
      function closeTutorial() {
        document.getElementById("tutorial-overlay").classList.remove("active");
      }
      document
        .getElementById("tutorial-overlay")
        .addEventListener("click", function (e) {
          if (e.target === this) closeTutorial();
        });

      // ‚îÄ‚îÄ BOT ‚îÄ‚îÄ
      function startBotGame() {
        myName = document.getElementById("player-name").value.trim();
        if (!myName) {
          showToast(t("typeName"));
          document.getElementById("player-name").focus();
          return;
        }
        botDifficulty = document.getElementById("bot-difficulty").value;
        botMode = true;
        isHost = true;
        kingMode = false;
        const botNames = {
          easy: currentLang === "en" ? "Easy Bot üé≤" : "Bot F√°cil üé≤",
          medium: currentLang === "en" ? "Medium Bot ‚öî" : "Bot M√©dio ‚öî",
          hard: currentLang === "en" ? "Hard Bot üíÄ" : "Bot Dif√≠cil üíÄ",
        };
        oppName = botNames[botDifficulty];
        document.getElementById("opp-name-display").textContent = oppName;
        document.getElementById("my-name-display").textContent = myName;
        document.getElementById("room-label").textContent = t("vsComputer");
        initBoards();
        gameStarted = true;
        myTurn = true;
        currentDie = null;
        showScreen("game");
        const oppDot = document.getElementById("opp-dot");
        if (oppDot)
          oppDot.outerHTML =
            '<span class="bot-indicator" id="opp-dot">ü§ñ</span>';
        renderBoards();
        updateTurnUI();
        setTimeout(rollMyDie, 600);
      }
      function botTakeTurn(dieValue) {
        const col = botChooseColumn(oppBoard, myBoard, dieValue, botDifficulty);
        const delay = { easy: 600, medium: 950, hard: 1300 }[botDifficulty];
        showRollingDie(dieValue, "rolling-die-container", true);
        document.getElementById("sub-status").textContent =
          oppName + t("opponentChoosing");
        botPendingTimeout = setTimeout(() => oppPlaced(col, dieValue), delay);
      }

      // ‚îÄ‚îÄ AUDIO ‚îÄ‚îÄ
      const AC = new (window.AudioContext || window.webkitAudioContext)();
      function playSound(tp) {
        if (AC.state === "suspended") AC.resume();
        if (tp === "roll") {
          for (let i = 0; i < 4; i++) {
            const o = AC.createOscillator(),
              g = AC.createGain();
            o.connect(g);
            g.connect(AC.destination);
            o.type = "square";
            o.frequency.setValueAtTime(
              180 + Math.random() * 120,
              AC.currentTime + i * 0.07,
            );
            g.gain.setValueAtTime(0.08, AC.currentTime + i * 0.07);
            g.gain.exponentialRampToValueAtTime(
              0.001,
              AC.currentTime + i * 0.07 + 0.06,
            );
            o.start(AC.currentTime + i * 0.07);
            o.stop(AC.currentTime + i * 0.07 + 0.07);
          }
        }
        if (tp === "place") {
          const o = AC.createOscillator(),
            g = AC.createGain();
          o.connect(g);
          g.connect(AC.destination);
          o.type = "sine";
          o.frequency.setValueAtTime(260, AC.currentTime);
          o.frequency.exponentialRampToValueAtTime(80, AC.currentTime + 0.08);
          g.gain.setValueAtTime(0.3, AC.currentTime);
          g.gain.exponentialRampToValueAtTime(0.001, AC.currentTime + 0.12);
          o.start(AC.currentTime);
          o.stop(AC.currentTime + 0.13);
        }
        if (tp === "cancel") {
          const b = AC.sampleRate * 0.12,
            buf = AC.createBuffer(1, b, AC.sampleRate),
            d = buf.getChannelData(0);
          for (let i = 0; i < b; i++)
            d[i] = (Math.random() * 2 - 1) * (1 - i / b);
          const s = AC.createBufferSource(),
            f = AC.createBiquadFilter(),
            g = AC.createGain();
          s.buffer = buf;
          f.type = "bandpass";
          f.frequency.value = 800;
          f.Q.value = 0.8;
          s.connect(f);
          f.connect(g);
          g.connect(AC.destination);
          g.gain.setValueAtTime(0.5, AC.currentTime);
          g.gain.exponentialRampToValueAtTime(0.001, AC.currentTime + 0.12);
          s.start(AC.currentTime);
        }
        if (tp === "win") {
          [330, 392, 494, 659].forEach((f, i) => {
            const o = AC.createOscillator(),
              g = AC.createGain();
            o.connect(g);
            g.connect(AC.destination);
            o.type = "triangle";
            o.frequency.value = f;
            g.gain.setValueAtTime(0, AC.currentTime + i * 0.12);
            g.gain.linearRampToValueAtTime(
              0.25,
              AC.currentTime + i * 0.12 + 0.04,
            );
            g.gain.exponentialRampToValueAtTime(
              0.001,
              AC.currentTime + i * 0.12 + 0.3,
            );
            o.start(AC.currentTime + i * 0.12);
            o.stop(AC.currentTime + i * 0.12 + 0.32);
          });
        }
        if (tp === "lose") {
          [330, 277, 220].forEach((f, i) => {
            const o = AC.createOscillator(),
              g = AC.createGain();
            o.connect(g);
            g.connect(AC.destination);
            o.type = "sawtooth";
            o.frequency.value = f;
            g.gain.setValueAtTime(0, AC.currentTime + i * 0.18);
            g.gain.linearRampToValueAtTime(
              0.15,
              AC.currentTime + i * 0.18 + 0.05,
            );
            g.gain.exponentialRampToValueAtTime(
              0.001,
              AC.currentTime + i * 0.18 + 0.35,
            );
            o.start(AC.currentTime + i * 0.18);
            o.stop(AC.currentTime + i * 0.18 + 0.37);
          });
        }
      }

      // ‚îÄ‚îÄ BOARDS ‚îÄ‚îÄ
      function initBoards() {
        myBoard = Array.from({ length: COLS }, () => Array(ROWS).fill(null));
        oppBoard = Array.from({ length: COLS }, () => Array(ROWS).fill(null));
      }
      function getPeerID(c) {
        return "knuckle-" + c.toUpperCase();
      }
      function checkPeer() {
        if (typeof Peer === "undefined") {
          showToast(t("p2pLoading"));
          return false;
        }
        return true;
      }

      // ‚îÄ‚îÄ CREATE / JOIN ROOMS ‚îÄ‚îÄ
      function createRoom() {
        if (!checkPeer()) return;
        myName = document.getElementById("player-name").value.trim();
        if (!myName) {
          showToast(t("typeName"));
          document.getElementById("player-name").focus();
          return;
        }
        roomCode = Math.random().toString(36).substring(2, 6).toUpperCase();
        isHost = true;
        kingMode = false;
        showScreen("waiting");
        document.getElementById("display-room-code").textContent = roomCode;
        document.getElementById("room-label").textContent =
          t("roomLabel") + roomCode;
        peer = new Peer(getPeerID(roomCode), { debug: 0 });
        peer.on("open", () =>
          peer.on("connection", (c) => {
            conn = c;
            setupConn();
          }),
        );
        peer.on("error", (e) => showToast("Erro: " + e.type));
      }
      function joinAnyRoom() {
        if (!checkPeer()) return;
        const code = document
          .getElementById("join-code")
          .value.trim()
          .toUpperCase();
        myName = document.getElementById("player-name").value.trim();
        if (!myName) {
          showToast(t("typeName"));
          document.getElementById("player-name").focus();
          return;
        }
        if (!code || code.length < 3) {
          showToast(t("typeCode"));
          return;
        }
        _pendingKingCode = code;
        showToast(t("checking"));
        const testPeer = new Peer(undefined, { debug: 0 });
        let resolved = false;
        testPeer.on("open", () => {
          const testConn = testPeer.connect("knuckle-king-" + code, {
            reliable: true,
          });
          const timer = setTimeout(() => {
            if (!resolved) {
              resolved = true;
              try {
                testConn.close();
              } catch (e) {}
              try {
                testPeer.destroy();
              } catch (e) {}
              _joinRoom1v1(code);
            }
          }, 2500);
          testConn.on("open", () => {
            if (!resolved) {
              resolved = true;
              clearTimeout(timer);
              try {
                testConn.close();
              } catch (e) {}
              try {
                testPeer.destroy();
              } catch (e) {}
              kingMyName = document.getElementById("player-name").value.trim();
              document
                .getElementById("king-join-modal")
                .classList.add("active");
            }
          });
          testConn.on("error", () => {
            if (!resolved) {
              resolved = true;
              clearTimeout(timer);
              try {
                testPeer.destroy();
              } catch (e) {}
              _joinRoom1v1(code);
            }
          });
        });
        testPeer.on("error", () => {
          if (!resolved) {
            resolved = true;
            _joinRoom1v1(code);
          }
        });
      }
      function _joinRoom1v1(code) {
        roomCode = code;
        isHost = false;
        kingMode = false;
        showScreen("waiting");
        document.getElementById("display-room-code").textContent = code;
        document.getElementById("display-room-code").style.fontSize = "2rem";
        document.getElementById("room-label").textContent =
          t("roomLabel") + code;
        peer = new Peer(undefined, { debug: 0 });
        peer.on("open", () => {
          conn = peer.connect(getPeerID(code));
          setupConn();
        });
        peer.on("error", () => {
          showToast(t("roomNotFound"));
          backToLobby();
        });
      }
      function setupConn() {
        conn.on("open", () => send({ type: "hello", name: myName }));
        conn.on("data", handleMessage);
        conn.on("close", () => {
          if (!gameStarted) return;
          const oppDot = document.getElementById("opp-dot");
          if (oppDot) {
            oppDot.classList.remove("dot-green");
            oppDot.classList.add("dot-grey");
          }
          let secs = 5;
          document.getElementById("turn-status").textContent =
            t("oppDisconnected");
          document.getElementById("turn-status").style.color = "#f87171";
          document.getElementById("sub-status").textContent =
            t("returningMenu") + secs + "s...";
          removeHighlights("my-board");
          const countdown = setInterval(() => {
            secs--;
            if (!gameStarted) {
              clearInterval(countdown);
              return;
            }
            if (secs <= 0) {
              clearInterval(countdown);
              backToLobby();
            } else
              document.getElementById("sub-status").textContent =
                t("returningMenu") + secs + "s...";
          }, 1000);
        });
      }
      function send(o) {
        if (conn && conn.open) conn.send(o);
      }
      function handleMessage(d) {
        switch (d.type) {
          case "hello":
            oppName = d.name;
            document.getElementById("opp-name-display").textContent = oppName;
            if (isHost) {
              send({ type: "start", oppName: myName });
              startGame(true);
            }
            break;
          case "start":
            oppName = d.oppName;
            document.getElementById("opp-name-display").textContent = oppName;
            startGame(false);
            break;
          case "rolled":
            oppRolled(d.value);
            break;
          case "placed":
            oppPlaced(d.col, d.value);
            break;
          case "sync":
            oppBoard = d.board;
            renderBoards();
            break;
          case "rematch-request":
            document.getElementById("rematch-btn-opp").style.display = "block";
            document.getElementById("rematch-status").textContent =
              oppName +
              (currentLang === "en" ? " wants a rematch!" : " quer revanche!");
            break;
          case "rematch-accept":
            document
              .getElementById("winner-overlay")
              .classList.remove("active");
            rematchRequestedByMe = false;
            startGame(true);
            break;
        }
      }
      function startGame(g) {
        initBoards();
        gameStarted = true;
        myTurn = g;
        currentDie = null;
        document.getElementById("my-name-display").textContent = myName;
        document.getElementById("opp-name-display").textContent = oppName;
        document.getElementById("room-label").textContent = botMode
          ? t("vsComputer")
          : t("roomLabel") + roomCode;
        showScreen("game");
        renderBoards();
        updateTurnUI();
        if (myTurn) setTimeout(rollMyDie, 600);
      }
      function rollMyDie() {
        if (!myTurn || currentDie !== null) return;
        currentDie = Math.ceil(Math.random() * 6);
        animateRoll(currentDie, "rolling-die-container", () => {
          showRollingDie(currentDie, "rolling-die-container", false);
          updateTurnUI();
          highlightColumns("my-board", placeInColumn);
          if (!botMode) send({ type: "rolled", value: currentDie });
        });
      }
      function animateRoll(v, id, cb) {
        const c = document.getElementById(id);
        if (!c) return;
        c.innerHTML = `<div class="rolling-die is-rolling">?</div>`;
        playSound("roll");
        let n = 0;
        const ti = setInterval(() => {
          const el = c.querySelector(".rolling-die");
          if (el) el.textContent = Math.ceil(Math.random() * 6);
          if (++n > 8) {
            clearInterval(ti);
            cb();
          }
        }, 60);
      }
      function showRollingDie(v, id, isOpp) {
        const c = document.getElementById(id);
        if (!c) return;
        c.innerHTML = `<div class="rolling-die ${isOpp ? "is-opponent" : "is-settled"}">${v}</div>`;
      }
      function clearRollingDie(id) {
        const c = document.getElementById(id);
        if (c) c.innerHTML = "";
      }
      function oppRolled(v) {
        showRollingDie(v, "rolling-die-container", true);
        document.getElementById("sub-status").textContent =
          oppName + t("opponentChoosing");
      }
      function highlightColumns(bid, fn) {
        const b = bid === "my-board" ? myBoard : null;
        if (!b) return;
        document
          .getElementById(bid)
          .querySelectorAll(".board-col")
          .forEach((col, i) => {
            if (b[i].some((r) => r === null)) {
              col.classList.add("selectable");
              col.onclick = () => fn(i);
            }
          });
      }
      function removeHighlights(bid) {
        document
          .getElementById(bid)
          .querySelectorAll(".board-col")
          .forEach((c) => {
            c.classList.remove("selectable");
            c.onclick = null;
          });
      }
      function placeInColumn(i) {
        if (!myTurn || currentDie === null) return;
        const col = myBoard[i],
          r = col.findIndex((x) => x === null);
        if (r === -1) {
          showToast(t("fullCol"));
          return;
        }
        col[r] = currentDie;
        const v = currentDie;
        currentDie = null;
        myTurn = false;
        removeHighlights("my-board");
        clearRollingDie("rolling-die-container");
        playSound("place");
        cancelOppDice(i, v);
        if (!botMode) {
          send({ type: "placed", col: i, value: v });
          send({ type: "sync", board: myBoard });
        }
        renderBoards();
        if (!checkWin()) {
          updateTurnUI();
          if (botMode) {
            const botDie = Math.ceil(Math.random() * 6);
            botTakeTurn(botDie);
          }
        }
      }
      function oppPlaced(i, v) {
        const col = oppBoard[i],
          r = col.findIndex((x) => x === null);
        if (r !== -1) col[r] = v;
        cancelMyDice(i, v);
        clearRollingDie("rolling-die-container");
        renderBoards();
        myTurn = true;
        updateTurnUI();
        if (!checkWin()) setTimeout(rollMyDie, 500);
      }
      function cancelOppDice(i, v) {
        if (!oppBoard[i].some((d) => d === v)) return;
        playSound("cancel");
        const colEls = document
          .getElementById("opp-board")
          .querySelectorAll(".board-col");
        if (colEls[i])
          colEls[i].querySelectorAll(".die").forEach((el) => {
            if (el.textContent == String(v) && !el.classList.contains("empty"))
              el.classList.add("cancelling");
          });
        setTimeout(() => {
          oppBoard[i] = oppBoard[i].map((d) => (d === v ? null : d));
          compactCol(oppBoard[i]);
          renderBoards();
        }, 300);
      }
      function cancelMyDice(i, v) {
        if (!myBoard[i].some((d) => d === v)) return;
        playSound("cancel");
        const colEls = document
          .getElementById("my-board")
          .querySelectorAll(".board-col");
        if (colEls[i])
          colEls[i].querySelectorAll(".die").forEach((el) => {
            if (el.textContent == String(v) && !el.classList.contains("empty"))
              el.classList.add("cancelling");
          });
        setTimeout(() => {
          myBoard[i] = myBoard[i].map((d) => (d === v ? null : d));
          compactCol(myBoard[i]);
          renderBoards();
        }, 300);
      }
      function compactCol(c) {
        const vs = c.filter((v) => v !== null);
        for (let i = 0; i < ROWS; i++) c[i] = vs[i] ?? null;
      }
      function calcColScore(c) {
        const f = c.filter((v) => v !== null);
        if (!f.length) return 0;
        const m = {};
        f.forEach((v) => (m[v] = (m[v] || 0) + 1));
        return Object.entries(m).reduce(
          (s, [v, n]) => s + parseInt(v) * n * n,
          0,
        );
      }
      function calcTotalScore(b) {
        return b.reduce((s, c) => s + calcColScore(c), 0);
      }
      function isGameOver() {
        return (
          myBoard.every((c) => c.every((r) => r !== null)) ||
          oppBoard.every((c) => c.every((r) => r !== null))
        );
      }
      function checkWin() {
        if (!isGameOver()) return false;
        const ms = calcTotalScore(myBoard),
          os = calcTotalScore(oppBoard);
        const w =
          ms > os ? myName + t("won") : os > ms ? oppName + t("won") : t("tie");
        const e = ms > os ? "üèÜ" : os > ms ? "üíÄ" : "ü§ù";
        setTimeout(() => {
          document.getElementById("rematch-btn-opp").style.display = "none";
          document.getElementById("rematch-status").textContent = "";
          rematchRequestedByMe = false;
          document.getElementById("trophy-emoji").textContent = e;
          document.getElementById("winner-text").textContent = w;
          document.getElementById("winner-scores").textContent =
            `${myName}: ${ms}  ‚Ä¢  ${oppName}: ${os}`;
          document.getElementById("winner-1v1-btns").style.display = "flex";
          document.getElementById("winner-king-btns").style.display = "none";
          document.getElementById("winner-overlay").classList.add("active");
          if (ms !== os) playSound(ms > os ? "win" : "lose");
        }, 600);
        return true;
      }
      function updateTurnUI() {
        document.getElementById("my-score").textContent =
          calcTotalScore(myBoard);
        document.getElementById("opp-score").textContent =
          calcTotalScore(oppBoard);
        const el = document.getElementById("turn-status");
        document.getElementById("sub-status").textContent = "";
        if (myTurn) {
          el.textContent = currentDie !== null ? t("chooseCol") : t("yourTurn");
          el.style.color = "#e8c97a";
        } else {
          el.textContent = t("opponentTurn") + oppName;
          el.style.color = "#888";
        }
      }
      function renderBoards() {
        renderBoard("my-board", myBoard, true);
        renderBoard("opp-board", oppBoard, false);
        updateTurnUI();
      }
      function renderBoard(id, board, isMe) {
        const el = document.getElementById(id);
        el.innerHTML = "";
        for (let c = 0; c < COLS; c++) {
          const col = document.createElement("div");
          col.className = "board-col";
          col.dataset.col = c;
          const sc = document.createElement("div");
          sc.className = "col-score";
          const cs = calcColScore(board[c]);
          sc.textContent = cs > 0 ? cs : "0";
          sc.style.opacity = cs > 0 ? "1" : "0.2";
          if (!isMe) {
            col.appendChild(sc);
            for (let r = ROWS - 1; r >= 0; r--)
              col.appendChild(makeDie(board[c][r]));
          } else {
            for (let r = ROWS - 1; r >= 0; r--)
              col.appendChild(makeDie(board[c][r]));
            col.appendChild(sc);
          }
          el.appendChild(col);
        }
      }
      function makeDie(v) {
        const d = document.createElement("div");
        if (v === null) d.className = "die empty";
        else {
          d.className =
            "die " + (v >= 5 ? "val-high" : v >= 3 ? "val-mid" : "val-low");
          d.textContent = v;
        }
        return d;
      }

      // ‚ïê‚ïê‚ïê‚ïê KING MODE ‚ïê‚ïê‚ïê‚ïê
      function mkKingPeerID(c) {
        return "knuckle-king-" + c.toUpperCase();
      }
      function shortIdFromFull(f) {
        return f.replace("knuckle-king-peer-", "");
      }
      function emptyBoard() {
        return Array.from({ length: COLS }, () => Array(ROWS).fill(null));
      }
      function closeKingModal() {
        document.getElementById("king-join-modal").classList.remove("active");
        _pendingKingCode = "";
      }
      function confirmJoinKing(wq) {
        document.getElementById("king-join-modal").classList.remove("active");
        kingMyName = document.getElementById("player-name").value.trim();
        _doJoinKing(_pendingKingCode, wq);
        _pendingKingCode = "";
      }
      function createKingRoom() {
        if (!checkPeer()) return;
        kingMyName = document.getElementById("player-name").value.trim();
        if (!kingMyName) {
          showToast(t("typeName"));
          return;
        }
        kingMode = true;
        kingIsHost = true;
        kingRoomCode = Math.random().toString(36).substring(2, 6).toUpperCase();
        kingMyId = "host";
        kingState = {
          players: [
            {
              id: "host",
              name: kingMyName,
              wins: 0,
              streak: 0,
              status: "queued",
              isHost: true,
            },
          ],
          queue: ["host"],
          currentGame: null,
          gameRunning: false,
        };
        kingPeer = new Peer(mkKingPeerID(kingRoomCode), { debug: 0 });
        kingPeer.on("open", () => {
          showScreen("king-lobby");
          document.getElementById("king-room-label").textContent =
            t("roomLabel") + kingRoomCode;
          document.getElementById("king-host-badge").style.display = "flex";
          document.getElementById("king-host-warning").style.display = "block";
          renderKingLobby();
          kingPeer.on("connection", (c) => {
            const pid = c.peer;
            kingPeerConns[pid] = c;
            c.on("open", () => c.send({ type: "king-sync", state: kingState }));
            c.on("data", (d) => kingHostHandleMessage(pid, d));
            c.on("close", () => kingPeerDisconnected(pid));
          });
        });
        kingPeer.on("error", (e) => showToast("Erro: " + e.type));
      }
      function kingHostHandleMessage(peerId, data) {
        switch (data.type) {
          case "king-hello": {
            const pid = data.shortId,
              p = {
                id: pid,
                name: data.name,
                wins: 0,
                streak: 0,
                status: data.wantsQueue ? "queued" : "spectating",
                isHost: false,
              };
            kingState.players.push(p);
            if (data.wantsQueue) {
              if (kingState.queue.length < KING_MAX_QUEUE)
                kingState.queue.push(pid);
              else {
                p.status = "spectating";
                showToast(
                  data.name +
                    (currentLang === "en"
                      ? " joined as spectator (queue full)"
                      : " entrou como espectador (fila cheia)"),
                );
              }
            }
            kingBroadcastSync();
            if (!kingState.gameRunning) kingMaybeStartGame();
            break;
          }
          case "king-join-queue": {
            const pid = data.id,
              p = kingState.players.find((x) => x.id === pid);
            if (!p) return;
            if (kingState.queue.length >= KING_MAX_QUEUE) {
              kingSendTo(peerId, {
                type: "king-toast",
                msg: t("queueFull") + KING_MAX_QUEUE + ")",
              });
              return;
            }
            if (kingState.queue.includes(pid)) return;
            p.status = "queued";
            kingState.queue.push(pid);
            kingBroadcastSync();
            if (!kingState.gameRunning) kingMaybeStartGame();
            break;
          }
          case "king-leave-queue": {
            const pid = data.id,
              p = kingState.players.find((x) => x.id === pid);
            if (!p) return;
            kingState.queue = kingState.queue.filter((x) => x !== pid);
            if (p.status !== "playing") p.status = "spectating";
            kingBroadcastSync();
            break;
          }
          case "king-roll-notify": {
            if (kingState.currentGame)
              kingState.currentGame.pendingDie = {
                slot: data.slot,
                value: data.value,
              };
            Object.entries(kingPeerConns).forEach(([pid, c]) => {
              if (pid !== peerId && c && c.open)
                c.send({
                  type: "king-peer-rolled",
                  slot: data.slot,
                  value: data.value,
                });
            });
            kingUpdateOppDieUI(data.slot, data.value);
            break;
          }
          case "king-game-placed": {
            if (!kingState.currentGame || !kingState.gameRunning) return;
            const cg = kingState.currentGame;
            if (cg.turn !== data.slot) return;
            const board = data.slot === 0 ? cg.board0 : cg.board1,
              opBoard = data.slot === 0 ? cg.board1 : cg.board0;
            const col = board[data.col],
              row = col.findIndex((r) => r === null);
            if (row === -1) return;
            col[row] = data.value;
            opBoard[data.col] = opBoard[data.col].map((d) =>
              d === data.value ? null : d,
            );
            compactCol(opBoard[data.col]);
            cg.turn = 1 - cg.turn;
            cg.pendingDie = null;
            const ov0 = cg.board0.every((c) => c.every((r) => r !== null)),
              ov1 = cg.board1.every((c) => c.every((r) => r !== null));
            if (ov0 || ov1) {
              kingBroadcastSync();
              kingResolveGame();
            } else {
              kingBroadcastSync();
              kingSignalNextPlayer();
            }
            break;
          }
        }
      }
      function kingPeerDisconnected(peerId) {
        const pid = shortIdFromFull(peerId);
        const wp =
          kingState.currentGame &&
          (kingState.currentGame.player0 === pid ||
            kingState.currentGame.player1 === pid);
        kingState.players = kingState.players.filter((x) => x.id !== pid);
        kingState.queue = kingState.queue.filter((x) => x !== pid);
        if (wp && kingState.gameRunning) {
          const w =
            kingState.currentGame.player0 === pid
              ? kingState.currentGame.player1
              : kingState.currentGame.player0;
          kingResolveGameWithWinner(w, pid);
        } else {
          delete kingPeerConns[peerId];
          kingBroadcastSync();
        }
      }
      function kingBroadcastSync() {
        const m = { type: "king-sync", state: kingState };
        Object.values(kingPeerConns).forEach((c) => {
          if (c && c.open) c.send(m);
        });
        kingHandleSync(m);
      }
      function kingSendTo(fp, m) {
        const c = kingPeerConns[fp];
        if (c && c.open) c.send(m);
      }
      function kingHostSendToPlayer(pid, msg) {
        if (pid === "host") {
          if (msg.type === "king-your-turn") kingHostTakeTurn();
          return;
        }
        const fp = Object.keys(kingPeerConns).find(
          (k) => shortIdFromFull(k) === pid,
        );
        if (fp) kingSendTo(fp, msg);
      }
      function kingMaybeStartGame() {
        if (kingState.gameRunning || kingState.queue.length < 2) return;
        kingStartNextGame();
      }
      function kingStartNextGame() {
        const p0 = kingState.queue[0],
          p1 = kingState.queue[1];
        kingState.currentGame = {
          player0: p0,
          player1: p1,
          board0: emptyBoard(),
          board1: emptyBoard(),
          turn: 0,
          pendingDie: null,
        };
        kingState.gameRunning = true;
        kingState.players.forEach((p) => {
          if (p.id === p0 || p.id === p1) p.status = "playing";
          else if (kingState.queue.includes(p.id)) p.status = "queued";
          else p.status = "spectating";
        });
        kingBroadcastSync();
        setTimeout(
          () => kingHostSendToPlayer(p0, { type: "king-your-turn" }),
          800,
        );
      }
      function kingSignalNextPlayer() {
        const cg = kingState.currentGame;
        kingHostSendToPlayer(cg.turn === 0 ? cg.player0 : cg.player1, {
          type: "king-your-turn",
        });
      }
      function kingResolveGame() {
        const cg = kingState.currentGame,
          s0 = calcTotalScore(cg.board0),
          s1 = calcTotalScore(cg.board1);
        let w = null,
          l = null;
        if (s0 > s1) {
          w = cg.player0;
          l = cg.player1;
        } else if (s1 > s0) {
          w = cg.player1;
          l = cg.player0;
        }
        _kingFinish(w, l, s0, s1, cg.player0, cg.player1);
      }
      function kingResolveGameWithWinner(w, l) {
        const cg = kingState.currentGame;
        _kingFinish(
          w,
          l,
          calcTotalScore(cg.board0),
          calcTotalScore(cg.board1),
          cg.player0,
          cg.player1,
        );
      }
      function _kingFinish(wId, lId, s0, s1, p0id, p1id) {
        kingState.players.forEach((p) => {
          if (p.id === wId) {
            p.wins++;
            p.streak++;
          } else if (p.id === p0id || p.id === p1id) p.streak = 0;
        });
        kingState.queue = kingState.queue.filter(
          (x) => x !== p0id && x !== p1id,
        );
        if (wId) {
          kingState.queue.unshift(wId);
          const lp = kingState.players.find((x) => x.id === lId);
          if (lp) kingState.queue.push(lId);
        } else {
          if (kingState.players.find((x) => x.id === p0id))
            kingState.queue.push(p0id);
          if (kingState.players.find((x) => x.id === p1id))
            kingState.queue.push(p1id);
        }
        kingState.queue = kingState.queue.slice(0, KING_MAX_QUEUE);
        const wp = kingState.players.find((x) => x.id === wId),
          p0p = kingState.players.find((x) => x.id === p0id),
          p1p = kingState.players.find((x) => x.id === p1id);
        const gom = {
          type: "king-game-over",
          wId,
          winnerName: wp ? wp.name : "?",
          p0name: p0p ? p0p.name : "?",
          p1name: p1p ? p1p.name : "?",
          s0,
          s1,
        };
        kingState.currentGame = null;
        kingState.gameRunning = false;
        const sm = { type: "king-sync", state: kingState };
        Object.values(kingPeerConns).forEach((c) => {
          if (c && c.open) {
            c.send(sm);
            c.send(gom);
          }
        });
        kingHandleSync(sm);
        kingShowGameOver(gom);
        _kingNextGameTimeout = setTimeout(() => {
          if (!kingState) return;
          kingState.players.forEach((p) => {
            p.status = kingState.queue.includes(p.id) ? "queued" : "spectating";
          });
          kingBroadcastSync();
          kingMaybeStartGame();
        }, 5000);
      }
      function kingHostTakeTurn() {
        if (!kingState.gameRunning || !kingState.currentGame) return;
        const cg = kingState.currentGame;
        if (cg.player0 !== "host" && cg.player1 !== "host") return;
        kingHostSlot = cg.player0 === "host" ? 0 : 1;
        if (cg.turn !== kingHostSlot) return;
        kingHostDie = null;
        const fv = Math.ceil(Math.random() * 6);
        const cont = document.getElementById("king-rolling-die");
        cont.innerHTML = `<div class="rolling-die is-rolling">?</div>`;
        playSound("roll");
        let n = 0;
        const ti = setInterval(() => {
          const el = cont.querySelector(".rolling-die");
          if (el) el.textContent = Math.ceil(Math.random() * 6);
          if (++n > 8) {
            clearInterval(ti);
            kingHostDie = fv;
            cg.pendingDie = { slot: kingHostSlot, value: kingHostDie };
            Object.values(kingPeerConns).forEach((c) => {
              if (c && c.open)
                c.send({
                  type: "king-peer-rolled",
                  slot: kingHostSlot,
                  value: kingHostDie,
                });
            });
            showRollingDie(kingHostDie, "king-rolling-die", false);
            document.getElementById("king-turn-status").textContent =
              t("chooseCol");
            document.getElementById("king-turn-status").style.color = "#e8c97a";
            kingHighlightHostCols();
          }
        }, 60);
      }
      function kingHostPlace(i) {
        if (
          !kingState.gameRunning ||
          !kingState.currentGame ||
          kingHostDie === null
        )
          return;
        const cg = kingState.currentGame;
        if (cg.turn !== kingHostSlot) return;
        const board = kingHostSlot === 0 ? cg.board0 : cg.board1,
          opBoard = kingHostSlot === 0 ? cg.board1 : cg.board0;
        const col = board[i],
          row = col.findIndex((r) => r === null);
        if (row === -1) {
          showToast(t("fullCol"));
          return;
        }
        document
          .getElementById("king-my-board")
          .querySelectorAll(".board-col")
          .forEach((c) => {
            c.classList.remove("selectable");
            c.onclick = null;
          });
        col[row] = kingHostDie;
        const v = kingHostDie;
        kingHostDie = null;
        opBoard[i] = opBoard[i].map((d) => (d === v ? null : d));
        compactCol(opBoard[i]);
        cg.turn = 1 - cg.turn;
        cg.pendingDie = null;
        playSound("place");
        clearRollingDie("king-rolling-die");
        const ov0 = cg.board0.every((c) => c.every((r) => r !== null)),
          ov1 = cg.board1.every((c) => c.every((r) => r !== null));
        if (ov0 || ov1) {
          kingBroadcastSync();
          kingResolveGame();
        } else {
          kingBroadcastSync();
          kingSignalNextPlayer();
        }
      }
      function kingHighlightHostCols() {
        if (!kingState || !kingState.currentGame || kingHostDie === null)
          return;
        const cg = kingState.currentGame,
          mb = kingHostSlot === 0 ? cg.board0 : cg.board1;
        document
          .getElementById("king-my-board")
          .querySelectorAll(".board-col")
          .forEach((col, i) => {
            if (mb[i].some((r) => r === null)) {
              col.classList.add("selectable");
              col.onclick = () => kingHostPlace(i);
            }
          });
      }
      function kingUpdateOppDieUI(slot, value) {
        if (
          !document
            .getElementById("screen-king-game")
            .classList.contains("active")
        )
          return;
        if (!kingState || !kingState.currentGame) return;
        const cg = kingState.currentGame;
        if (kingHostSlot === slot) return;
        showRollingDie(value, "king-rolling-die", true);
        const rPid = slot === 0 ? cg.player0 : cg.player1,
          rP = kingState.players.find((p) => p.id === rPid);
        document.getElementById("king-sub-status").textContent =
          (rP?.name || t("opponent")) + t("opponentChoosing");
        document.getElementById("king-turn-status").textContent =
          t("opponentTurn") + (rP?.name || t("opponent"));
        document.getElementById("king-turn-status").style.color = "#888";
      }
      function _doJoinKing(code, wq) {
        kingMode = true;
        kingIsHost = false;
        kingRoomCode = code;
        kingMyId = Math.random().toString(36).substring(2, 7);
        kingPeer = new Peer("knuckle-king-peer-" + kingMyId, { debug: 0 });
        kingPeer.on("open", () => {
          kingHostConn = kingPeer.connect(mkKingPeerID(code));
          kingHostConn.on("open", () => {
            kingHostConn.send({
              type: "king-hello",
              name: kingMyName,
              shortId: kingMyId,
              wantsQueue: wq,
            });
            showScreen("king-lobby");
            document.getElementById("king-room-label").textContent =
              t("roomLabel") + code;
            document.getElementById("king-host-badge").style.display = "none";
            document.getElementById("king-host-warning").style.display = "none";
          });
          kingHostConn.on("data", (d) => kingGuestHandleMessage(d));
          kingHostConn.on("close", () => {
            showToast(t("hostDisconnected"));
            backToLobby();
          });
        });
        kingPeer.on("error", () => {
          showToast(t("roomNotFound"));
          backToLobby();
        });
      }
      function kingGuestHandleMessage(d) {
        switch (d.type) {
          case "king-sync":
            kingState = d.state;
            kingHandleSync(d);
            break;
          case "king-game-over":
            kingShowGameOver(d);
            break;
          case "king-your-turn":
            kingGuestStartTurn();
            break;
          case "king-peer-rolled":
            kingHandleOppRolled(d);
            break;
          case "king-toast":
            showToast(d.msg);
            break;
        }
      }
      function kingHandleSync(data) {
        if (data.type === "king-sync") kingState = data.state;
        if (!kingState || !kingState.players) return;
        if (kingState.gameRunning && kingState.currentGame) {
          const onGame = document
            .getElementById("screen-king-game")
            .classList.contains("active");
          if (
            !onGame &&
            !document
              .getElementById("winner-overlay")
              .classList.contains("active")
          )
            showScreen("king-game");
          const myTurnActive =
            (kingIsHost && kingHostDie !== null) ||
            (!kingIsHost && kgGuestMyTurnFlag && kgGuestDie !== null);
          if (myTurnActive) _partialKingGameUpdate();
          else renderKingGame();
        } else {
          if (
            document
              .getElementById("screen-king-game")
              .classList.contains("active") &&
            !document
              .getElementById("winner-overlay")
              .classList.contains("active")
          )
            showScreen("king-lobby");
          renderKingLobby();
        }
        if (
          document
            .getElementById("screen-king-lobby")
            .classList.contains("active") &&
          kingState?.players
        )
          renderKingLobby();
      }
      function _partialKingGameUpdate() {
        if (!kingState || !kingState.currentGame) return;
        const cg = kingState.currentGame,
          myId = kingIsHost ? "host" : kingMyId;
        const mySlot = cg.player0 === myId ? 0 : cg.player1 === myId ? 1 : -1;
        if (mySlot === -1) return;
        const myBD = mySlot === 0 ? cg.board0 : cg.board1,
          oppBD = mySlot === 0 ? cg.board1 : cg.board0;
        const oppId = mySlot === 0 ? cg.player1 : cg.player0,
          oppP = kingState.players.find((p) => p.id === oppId);
        document.getElementById("king-my-score").textContent =
          calcTotalScore(myBD);
        document.getElementById("king-opp-score").textContent =
          calcTotalScore(oppBD);
        document.getElementById("king-opp-name").textContent =
          oppP?.name || t("opponent");
        renderBoard("king-opp-board", oppBD, false);
        renderBoard("king-my-board", myBD, true);
        if (kingIsHost) kingHighlightHostCols();
        else kingHighlightGuestCols();
      }
      function kingGuestStartTurn() {
        kgGuestMyTurnFlag = true;
        const cg = kingState.currentGame;
        if (!cg) return;
        kgGuestMySlot = cg.player0 === kingMyId ? 0 : 1;
        const fv = Math.ceil(Math.random() * 6);
        const cont = document.getElementById("king-rolling-die");
        cont.innerHTML = `<div class="rolling-die is-rolling">?</div>`;
        playSound("roll");
        let n = 0;
        const ti = setInterval(() => {
          const el = cont.querySelector(".rolling-die");
          if (el) el.textContent = Math.ceil(Math.random() * 6);
          if (++n > 8) {
            clearInterval(ti);
            kgGuestDie = fv;
            cg.pendingDie = { slot: kgGuestMySlot, value: kgGuestDie };
            kingHostConn.send({
              type: "king-roll-notify",
              slot: kgGuestMySlot,
              value: kgGuestDie,
            });
            showRollingDie(kgGuestDie, "king-rolling-die", false);
            document.getElementById("king-turn-status").textContent =
              t("chooseCol");
            document.getElementById("king-turn-status").style.color = "#e8c97a";
            document.getElementById("king-sub-status").textContent = "";
            kingHighlightGuestCols();
          }
        }, 60);
      }
      function kingGuestPlace(i) {
        if (!kgGuestMyTurnFlag || kgGuestDie === null) return;
        const cg = kingState.currentGame;
        if (!cg) return;
        const board = kgGuestMySlot === 0 ? cg.board0 : cg.board1;
        if (board[i].every((r) => r !== null)) {
          showToast(t("fullCol"));
          return;
        }
        kgGuestMyTurnFlag = false;
        playSound("place");
        clearRollingDie("king-rolling-die");
        document
          .getElementById("king-my-board")
          .querySelectorAll(".board-col")
          .forEach((c) => {
            c.classList.remove("selectable");
            c.onclick = null;
          });
        kingHostConn.send({
          type: "king-game-placed",
          col: i,
          value: kgGuestDie,
          slot: kgGuestMySlot,
        });
        kgGuestDie = null;
      }
      function kingHighlightGuestCols() {
        if (
          !kingState ||
          !kingState.currentGame ||
          !kgGuestMyTurnFlag ||
          kgGuestDie === null
        )
          return;
        const cg = kingState.currentGame,
          mb = kgGuestMySlot === 0 ? cg.board0 : cg.board1;
        document
          .getElementById("king-my-board")
          .querySelectorAll(".board-col")
          .forEach((col, i) => {
            col.classList.remove("selectable");
            col.onclick = null;
            if (mb[i].some((r) => r === null)) {
              col.classList.add("selectable");
              col.onclick = () => kingGuestPlace(i);
            }
          });
      }
      function kingHandleOppRolled(d) {
        if (!kingState || !kingState.currentGame) return;
        const myId = kingIsHost ? "host" : kingMyId,
          cg = kingState.currentGame;
        const mySlot = cg.player0 === myId ? 0 : cg.player1 === myId ? 1 : -1;
        if (mySlot === d.slot) return;
        showRollingDie(d.value, "king-rolling-die", true);
        const rPid = d.slot === 0 ? cg.player0 : cg.player1,
          rP = kingState.players.find((p) => p.id === rPid);
        if (mySlot === -1)
          document.getElementById("king-sub-status").textContent =
            (rP?.name || "?") + t("rolling") + d.value;
        else {
          document.getElementById("king-sub-status").textContent =
            (rP?.name || t("opponent")) + t("opponentChoosing");
          document.getElementById("king-turn-status").textContent =
            t("opponentTurn") + (rP?.name || t("opponent"));
          document.getElementById("king-turn-status").style.color = "#888";
        }
      }
      function renderKingLobby() {
        if (!kingState?.players) return;
        document.getElementById("king-room-label").textContent =
          t("roomLabel") + kingRoomCode;
        const myId = kingIsHost ? "host" : kingMyId;
        document.getElementById("king-host-badge").style.display = kingIsHost
          ? "flex"
          : "none";
        document.getElementById("king-host-warning").style.display = kingIsHost
          ? "block"
          : "none";
        const mi = document.getElementById("king-current-match-info");
        if (kingState.gameRunning && kingState.currentGame) {
          const cg = kingState.currentGame,
            p0 = kingState.players.find((x) => x.id === cg.player0),
            p1 = kingState.players.find((x) => x.id === cg.player1);
          mi.innerHTML = `<div class="match-vs-row"><span class="match-player-name">${p0?.name || "?"}</span><span class="match-vs">VS</span><span class="match-player-name">${p1?.name || "?"}</span></div><div class="match-score-row"><span class="match-score-val">${calcTotalScore(cg.board0)}</span><span class="match-score-sep">‚Ä¢</span><span class="match-score-val">${calcTotalScore(cg.board1)}</span></div>`;
        } else
          mi.innerHTML = `<span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:rgba(201,168,76,.3)">${t("waitingPlayers")}</span>`;
        const le = document.getElementById("king-player-list");
        le.innerHTML = "";
        [...kingState.players]
          .sort((a, b) => {
            const o = { playing: 0, queued: 1, spectating: 2 };
            if (o[a.status] !== o[b.status]) return o[a.status] - o[b.status];
            const ai = kingState.queue.indexOf(a.id),
              bi = kingState.queue.indexOf(b.id);
            return ai !== -1 && bi !== -1 ? ai - bi : 0;
          })
          .forEach((p) => {
            const isMe = p.id === myId,
              qp = kingState.queue.indexOf(p.id);
            const pl = qp === 0 ? "‚ôõ" : qp > 0 ? qp + 1 + "" : "üëÅ";
            const card = document.createElement("div");
            card.className = "player-card " + p.status;
            let bc = "badge-spectating",
              bt = t("badgeSpectating");
            if (p.isHost) {
              bc = "badge-host";
              bt = t("badgeHost");
            } else if (p.status === "playing") {
              bc = "badge-playing";
              bt = t("badgePlaying");
            } else if (p.status === "queued") {
              bc = "badge-queued";
              bt = t("badgeQueue");
            }
            card.innerHTML = `<div class="pc-position ${qp <= 1 && p.status !== "spectating" ? "active-pos" : ""}">${pl}</div><div class="pc-name ${isMe ? "is-me" : ""}">${p.isHost ? "‚≠ê " : ""}${p.name}${isMe ? " ‚ú¶" : ""}</div><div class="pc-badge ${bc}">${bt}</div>`;
            le.appendChild(card);
          });
        const re = document.getElementById("king-ranking-list");
        re.innerHTML = "";
        [...kingState.players]
          .sort((a, b) => b.wins - a.wins || b.streak - a.streak)
          .forEach((p, i) => {
            const isMe = p.id === myId,
              medal =
                i === 0 ? "ü•á" : i === 1 ? "ü•à" : i === 2 ? "ü•â" : i + 1 + "";
            const row = document.createElement("div");
            row.className = "ranking-row";
            row.innerHTML = `<span class="rank-pos ${i === 0 ? "gold-rank" : ""}">${medal}</span><span class="rank-name ${isMe ? "is-me" : ""}">${p.name}${isMe ? " ‚ú¶" : ""}</span><span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:var(--gold)">${p.wins > 0 ? "üèÜ" + p.wins : ""}</span><span style="font-family:'Cinzel Decorative',cursive;font-size:.68rem;color:#f97316">${p.streak >= 2 ? "üî•" + p.streak : ""}</span>`;
            re.appendChild(row);
          });
        const qe = document.getElementById("king-queue-display");
        qe.innerHTML = "";
        if (!kingState.queue.length)
          qe.innerHTML = `<div style="font-family:'Cinzel Decorative',cursive;font-size:.68rem;color:rgba(201,168,76,.25)">${t("emptyQueue")}</div>`;
        kingState.queue
          .filter((pid) => {
            const p = kingState.players.find((x) => x.id === pid);
            return p?.status !== "playing";
          })
          .forEach((pid, i) => {
            const p = kingState.players.find((x) => x.id === pid);
            if (!p) return;
            const isMe = p.id === myId;
            const el = document.createElement("div");
            el.className = "queue-mini-item";
            el.innerHTML = `<span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:rgba(201,168,76,.4)">${i + 1}.</span><span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:${isMe ? "#e8c97a" : "var(--cream)"}"> ${p.status === "playing" ? "‚öî " : ""}${p.isHost ? "‚≠ê " : ""}${p.name}${isMe ? " ‚ú¶" : ""}</span>`;
            qe.appendChild(el);
          });
        const me = kingState.players.find((x) => x.id === myId),
          inQ = me && kingState.queue.includes(myId);
        document.getElementById("king-join-queue-btn").style.display =
          !inQ && me?.status !== "playing" ? "block" : "none";
        document.getElementById("king-leave-queue-btn").style.display =
          inQ && me?.status !== "playing" ? "block" : "none";
      }
      function renderKingGame() {
        if (!kingState || !kingState.currentGame) return;
        const cg = kingState.currentGame,
          myId = kingIsHost ? "host" : kingMyId;
        const mySlot = cg.player0 === myId ? 0 : cg.player1 === myId ? 1 : -1,
          isPlaying = mySlot !== -1;
        const myBD =
          mySlot === 0 ? cg.board0 : mySlot === 1 ? cg.board1 : cg.board0;
        const oppBD =
          mySlot === 0 ? cg.board1 : mySlot === 1 ? cg.board0 : cg.board1;
        const myP = kingState.players.find((p) => p.id === myId);
        const oppId =
          mySlot === 0 ? cg.player1 : mySlot === 1 ? cg.player0 : cg.player1;
        const oppP = kingState.players.find((p) => p.id === oppId);
        document.getElementById("king-room-label-game").textContent =
          t("roomLabel") + kingRoomCode;
        const sb = document.getElementById("king-spectator-banner");
        if (!isPlaying) {
          const qp = kingState.queue.indexOf(myId);
          sb.textContent =
            qp > 0
              ? t("spectatingQueue") + (qp - 1 + 1) + t("spectatingWatching")
              : t("watchingJoinHint");
          sb.style.display = "block";
        } else sb.style.display = "none";
        if (isPlaying) {
          document.getElementById("king-my-name").textContent =
            myP?.name || t("you");
          document.getElementById("king-opp-name").textContent =
            oppP?.name || t("opponent");
          document.getElementById("king-my-score").textContent =
            calcTotalScore(myBD);
          document.getElementById("king-opp-score").textContent =
            calcTotalScore(oppBD);
          renderBoard("king-my-board", myBD, true);
          renderBoard("king-opp-board", oppBD, false);
          const isMyTurn = cg.turn === mySlot,
            ts = document.getElementById("king-turn-status"),
            ss = document.getElementById("king-sub-status");
          if (isMyTurn) {
            const myDie = kingIsHost ? kingHostDie : kgGuestDie;
            ts.textContent = myDie !== null ? t("chooseCol") : t("yourTurn");
            ts.style.color = "#e8c97a";
            ss.textContent = "";
            if (myDie !== null) {
              showRollingDie(myDie, "king-rolling-die", false);
              if (kingIsHost) kingHighlightHostCols();
              else kingHighlightGuestCols();
            }
          } else {
            ts.textContent = t("opponentTurn") + (oppP?.name || t("opponent"));
            ts.style.color = "#888";
            if (cg.pendingDie && cg.pendingDie.slot !== mySlot) {
              showRollingDie(cg.pendingDie.value, "king-rolling-die", true);
              ss.textContent =
                (oppP?.name || t("opponent")) + t("opponentChoosing");
            }
          }
        } else {
          const p0 = kingState.players.find((x) => x.id === cg.player0),
            p1 = kingState.players.find((x) => x.id === cg.player1);
          document.getElementById("king-my-name").textContent = p0?.name || "?";
          document.getElementById("king-opp-name").textContent =
            p1?.name || "?";
          document.getElementById("king-my-score").textContent = calcTotalScore(
            cg.board0,
          );
          document.getElementById("king-opp-score").textContent =
            calcTotalScore(cg.board1);
          renderBoard("king-my-board", cg.board0, true);
          renderBoard("king-opp-board", cg.board1, false);
          document.getElementById("king-turn-status").textContent =
            t("watching");
          document.getElementById("king-turn-status").style.color = "#666";
          if (cg.pendingDie) {
            const rp = kingState.players.find(
              (p) =>
                p.id === (cg.pendingDie.slot === 0 ? cg.player0 : cg.player1),
            );
            showRollingDie(cg.pendingDie.value, "king-rolling-die", true);
            document.getElementById("king-sub-status").textContent =
              (rp?.name || "?") + t("opponentChoosing");
          }
        }
        const qm = document.getElementById("king-queue-mini");
        qm.innerHTML = "";
        const pl = [cg.player0, cg.player1];
        kingState.queue
          .filter((pid) => {
            const p = kingState.players.find((x) => x.id === pid);
            return p?.status !== "playing";
          })
          .forEach((pid, i) => {
            const p = kingState.players.find((x) => x.id === pid);
            if (!p) return;
            const isMe = p.id === myId,
              isAct = pl.includes(pid);
            const el = document.createElement("div");
            el.className = "queue-mini-item";
            el.innerHTML = `<span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:rgba(201,168,76,.4)">${i + 1}.</span><span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:${isMe ? "#e8c97a" : isAct ? "#fef08a" : "var(--cream)"}"> ${isAct ? "‚öî " : ""}${p.isHost ? "‚≠ê " : ""}${p.name}${isMe ? " ‚ú¶" : ""}</span>${p.wins > 0 ? `<span style="font-family:'Cinzel Decorative',cursive;font-size:.6rem;color:var(--gold)">üèÜ${p.wins}</span>` : ""}`;
            qm.appendChild(el);
          });
        const rm = document.getElementById("king-ranking-mini");
        rm.innerHTML = "";
        [...kingState.players]
          .sort((a, b) => b.wins - a.wins || b.streak - a.streak)
          .forEach((p, i) => {
            const isMe = p.id === myId,
              medal =
                i === 0 ? "ü•á" : i === 1 ? "ü•à" : i === 2 ? "ü•â" : i + 1 + "";
            const el = document.createElement("div");
            el.className = "queue-mini-item";
            el.innerHTML = `<span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:rgba(201,168,76,.4)">${medal}</span><span style="font-family:'Cinzel Decorative',cursive;font-size:.75rem;color:${isMe ? "#e8c97a" : "var(--cream)"}"> ${p.name}${isMe ? " ‚ú¶" : ""}</span><span style="font-family:'Cinzel Decorative',cursive;font-size:.68rem;color:var(--gold)">${p.wins > 0 ? "üèÜ" + p.wins : ""}</span>`;
            rm.appendChild(el);
          });
        const inQ = kingState.queue.includes(myId);
        document.getElementById("king-game-join-btn").style.display =
          !inQ && !isPlaying ? "block" : "none";
        document.getElementById("king-game-leave-btn").style.display =
          inQ && !isPlaying ? "block" : "none";
      }
      function kingShowGameOver(d) {
        document.getElementById("winner-1v1-btns").style.display = "none";
        document.getElementById("winner-king-btns").style.display = "flex";
        const myId = kingIsHost ? "host" : kingMyId,
          iWon = d.wId === myId,
          tie = d.wId === null;
        document.getElementById("trophy-emoji").textContent = tie
          ? "ü§ù"
          : iWon
            ? "üèÜ"
            : "üíÄ";
        document.getElementById("winner-text").textContent = tie
          ? t("tie")
          : d.winnerName + t("won");
        document.getElementById("winner-scores").textContent =
          `${d.p0name}: ${d.s0}  ‚Ä¢  ${d.p1name}: ${d.s1}`;
        document.getElementById("king-next-match-msg").textContent =
          t("nextMatch");
        document.getElementById("winner-overlay").classList.add("active");
        if (!tie) playSound(iWon ? "win" : "lose");
        _kingOverlayTimeout = setTimeout(() => {
          if (!kingState) return;
          document.getElementById("winner-overlay").classList.remove("active");
          showScreen("king-lobby");
          renderKingLobby();
        }, 4500);
      }
      function kingJoinQueue() {
        if (kingIsHost) {
          if (kingState.queue.length >= KING_MAX_QUEUE) {
            showToast(t("queueFull") + KING_MAX_QUEUE + ")");
            return;
          }
          if (kingState.queue.includes("host")) return;
          const p = kingState.players.find((x) => x.id === "host");
          if (p) p.status = "queued";
          kingState.queue.push("host");
          kingBroadcastSync();
          if (!kingState.gameRunning) kingMaybeStartGame();
        } else {
          if (!kingHostConn || !kingHostConn.open) return;
          const p = kingState.players.find((x) => x.id === kingMyId);
          if (p && !kingState.queue.includes(kingMyId)) {
            p.status = "queued";
            kingState.queue.push(kingMyId);
            renderKingLobby();
          }
          kingHostConn.send({ type: "king-join-queue", id: kingMyId });
        }
      }
      function kingLeaveQueue() {
        if (kingIsHost) {
          kingState.queue = kingState.queue.filter((x) => x !== "host");
          const p = kingState.players.find((x) => x.id === "host");
          if (p && p.status !== "playing") p.status = "spectating";
          kingBroadcastSync();
          renderKingLobby();
        } else {
          if (!kingHostConn || !kingHostConn.open) return;
          const p = kingState.players.find((x) => x.id === kingMyId);
          if (p && p.status !== "playing") {
            p.status = "spectating";
            kingState.queue = kingState.queue.filter((x) => x !== kingMyId);
            renderKingLobby();
          }
          kingHostConn.send({ type: "king-leave-queue", id: kingMyId });
        }
      }

      // ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
      function showScreen(n) {
        document
          .querySelectorAll(".screen")
          .forEach((s) => s.classList.remove("active"));
        document.getElementById("screen-" + n).classList.add("active");
      }
      function copyCode() {
        navigator.clipboard
          .writeText(roomCode)
          .then(() => showToast(t("codeCopied")))
          .catch(() => prompt("Copy:", roomCode));
      }
      function copyKingCode() {
        navigator.clipboard
          .writeText(kingRoomCode)
          .then(() => showToast(t("codeCopied")))
          .catch(() => prompt("Copy:", kingRoomCode));
      }
      function backToLobby() {
        botMode = false;
        if (botPendingTimeout) {
          clearTimeout(botPendingTimeout);
          botPendingTimeout = null;
        }
        const oppDot = document.getElementById("opp-dot");
        if (oppDot && !oppDot.classList.contains("dot")) {
          oppDot.outerHTML = '<span class="dot dot-green" id="opp-dot"></span>';
        } else if (oppDot) {
          oppDot.classList.remove("dot-grey");
          oppDot.classList.add("dot-green");
        }
        if (_kingNextGameTimeout) {
          clearTimeout(_kingNextGameTimeout);
          _kingNextGameTimeout = null;
        }
        if (_kingOverlayTimeout) {
          clearTimeout(_kingOverlayTimeout);
          _kingOverlayTimeout = null;
        }
        if (peer) {
          try {
            peer.destroy();
          } catch (e) {}
          peer = null;
        }
        conn = null;
        gameStarted = false;
        if (kingPeer) {
          try {
            kingPeer.destroy();
          } catch (e) {}
          kingPeer = null;
        }
        kingHostConn = null;
        kingPeerConns = {};
        kingState = null;
        kingMode = false;
        kingIsHost = false;
        kgGuestMyTurnFlag = false;
        kgGuestDie = null;
        kingHostDie = null;
        kingHostSlot = -1;
        document.getElementById("winner-overlay").classList.remove("active");
        document.getElementById("king-join-modal").classList.remove("active");
        document.getElementById("tutorial-overlay").classList.remove("active");
        showScreen("lobby");
      }
      function resetGame() {
        document.getElementById("winner-overlay").classList.remove("active");
        backToLobby();
      }
      function requestRematch() {
        if (botMode) {
          document.getElementById("winner-overlay").classList.remove("active");
          document.getElementById("rematch-status").textContent = "";
          rematchRequestedByMe = false;
          initBoards();
          myTurn = true;
          currentDie = null;
          showScreen("game");
          renderBoards();
          updateTurnUI();
          setTimeout(rollMyDie, 600);
          return;
        }
        rematchRequestedByMe = true;
        document.getElementById("rematch-status").textContent =
          t("waitingFor") + oppName + "...";
        send({ type: "rematch-request" });
      }
      function acceptRematch() {
        send({ type: "rematch-accept" });
        document.getElementById("winner-overlay").classList.remove("active");
        document.getElementById("rematch-btn-opp").style.display = "none";
        document.getElementById("rematch-status").textContent = "";
        rematchRequestedByMe = false;
        startGame(false);
      }
      function showToast(msg) {
        const t2 = document.getElementById("toast");
        t2.textContent = msg;
        t2.classList.add("show");
        setTimeout(() => t2.classList.remove("show"), 2500);
      }

      // ‚îÄ‚îÄ INPUT EVENTS ‚îÄ‚îÄ
      document
        .getElementById("join-code")
        .addEventListener("input", function () {
          this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, "");
        });
      document.getElementById("join-code").addEventListener("keydown", (e) => {
        if (e.key === "Enter") joinAnyRoom();
      });
      document
        .getElementById("player-name")
        .addEventListener("keydown", (e) => {
          if (e.key === "Enter") document.getElementById("join-code").focus();
        });

      // ‚îÄ‚îÄ INIT TRANSLATIONS on load ‚îÄ‚îÄ
      applyTranslations();
    </script>
  </body>
</html>
